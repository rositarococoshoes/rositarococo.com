# Technical Architecture Document
## Rosita Rococó E-commerce Funnel Migration to Astro

**Version**: 1.0
**Date**: 2025-11-12
**Status**: Ready for Implementation
**Architecture Pattern**: Static Site Generation with Client-side Interactivity

---

## 1. Architecture Overview

### 1.1 System Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                    Rosita Rococó E-commerce Funnel                │
├─────────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐ │
│  │   Astro SSG      │    │  Alpine.js      │    │  Chrome DevTools│ │
│  │  (Build Time)    │    │ (Client Runtime) │    │  (MCP Testing) │ │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘ │
│           │                       │                       │         │
│  ┌─────────────────────────────────────────────────────────────────┐ │
│  │                    Client-side Layer                           │ │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────┐ │ │
│  │  │Swiper.js    │ │Tailwind CSS │ │LocalStorage │ │Forms.js│ │ │
│  │  │Carruseles   │ │Estilos      │ │Persistencia │ │Valida- │ │ │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ │ción   │ │ │
│  │                                                    └─────────┘ │ │
│  └─────────────────────────────────────────────────────────────────┘ │
│                                                               │
│  ┌─────────────────────────────────────────────────────────────────┐ │
│  │                     External Services                          │ │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────┐ │ │
│  │  │Google Forms │ │Facebook     │ │Google Fonts │ │Images  │ │ │
│  │  │Checkout     │ │Pixel        │ │Typography  │ │CDN     │ │ │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────┘ │ │
│  └─────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 Data Flow Architecture

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Product Data   │    │   User Actions   │    │   External APIs  │
│   (TypeScript)    │    │   (Alpine.js)    │    │   (JavaScript)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                        │                        │
         │                        │                        │
    ┌────▼────┐              ┌─────▼─────┐              ┌─────▼─────┐
    │   Astro  │              │ Alpine.js │              │ Fetch API │
    │   Build  │              │  Store    │              │ Requests  │
    └────┬────┘              └─────┬─────┘              └─────┬─────┘
         │                        │                        │
         ▼                        ▼                        ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Static HTML + CSS + JS                           │
│                     (Generated by Astro)                            │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. Component Architecture

### 2.1 Component Hierarchy

```
src/
├── components/
│   ├── shared/                    # Reusable components
│   │   ├── Button.astro
│   │   ├── Modal.astro
│   │   └── LoadingSpinner.astro
│   ├── layout/                    # Layout components
│   │   ├── Header.astro           # Main header with benefits bar
│   │   └── Footer.astro
│   ├── product/                   # Product-related components
│   │   ├── ProductCard.astro      # Main product showcase
│   │   ├── ProductGallery.astro   # Image carrusel
│   │   ├── ProductSpecs.astro     # Product specifications
│   │   ├── SizeSelector.astro     # Size selection
│   │   └── QuantitySelector.astro # Quantity selection
│   ├── cart/                      # Shopping cart components
│   │   ├── MiniCart.astro         # Floating cart sidebar
│   │   ├── CartItem.astro         # Individual cart item
│   │   ├── CartSummary.astro      # Cart totals
│   │   └── EmptyCart.astro        # Empty state
│   ├── checkout/                  # Checkout components
│   │   ├── CheckoutForm.astro     # Main checkout form
│   │   ├── ContactForm.astro      # Contact information
│   │   ├── ShippingForm.astro     # Shipping details
│   │   ├── PaymentMethod.astro    # Payment selection
│   │   └── OrderSummary.astro     # Order review
│   └── testimonials/               # Testimonials components
│       ├── TestimonialsGrid.astro # Main testimonials section
│       ├── TestimonialCard.astro  # Individual testimonial
│       └── LoadMoreButton.astro   # Load more functionality
└── pages/
    └── index.astro                 # Main funnel page
```

### 2.2 Component Data Flow

#### ProductCard Data Flow
```
ProductCard.astro
    ↓ (receives product data)
ProductGallery.astro (Swiper.js)
    ↓ (user selects options)
SizeSelector.astro + QuantitySelector.astro
    ↓ (user adds to cart)
Alpine.js Cart Store
    ↓ (persists data)
LocalStorage
```

#### Checkout Data Flow
```
CheckoutForm.astro
    ↓ (user fills form)
Form Validation (HTML5 + JavaScript)
    ↓ (form submitted)
Google Forms API
    ↓ (success/failure)
Confirmation Page
```

---

## 3. Data Management

### 3.1 Data Layer Architecture

#### Product Data Structure
```typescript
interface Product {
  id: string;
  name: string;
  category: 'guillermina' | 'birk';
  color: 'negras' | 'blancas' | 'camel';
  price: number;
  promoPrice?: number;
  description: string;
  material: string;
  sole: string;
  shipping: string;
  images: string[];
  sizes: Size[];
  badges: Badge[];
  specs: ProductSpecs;
  isNew?: boolean;
  isLimited?: boolean;
  availableSizes: number[];
}

interface CartItem extends Product {
  quantity: number;
  selectedSize: string;
  selectedSecondSize?: string; // For 2 pairs
  totalPrice: number;
}

interface CartState {
  items: CartItem[];
  isOpen: boolean;
  total: number;
  itemCount: number;
}
```

#### Testimonials Data Structure
```typescript
interface Testimonial {
  src: string;
  alt: string;
  author?: string;
  caption?: string;
  date?: string;
  rating?: number;
  category?: 'whatsapp' | 'instagram' | 'general';
}
```

### 3.2 State Management Strategy

#### Alpine.js Cart Store
```javascript
function createCartStore() {
  return {
    items: [],
    isOpen: false,

    init() {
      // Load from localStorage
      const savedCart = localStorage.getItem('rosita-cart');
      if (savedCart) {
        this.items = JSON.parse(savedCart);
      }

      // Watch for changes and persist
      this.$watch('items', () => {
        localStorage.setItem('rosita-cart', JSON.stringify(this.items));
      });
    },

    get total() {
      return this.items.reduce((sum, item) => sum + item.totalPrice, 0);
    },

    get itemCount() {
      return this.items.reduce((sum, item) => sum + item.quantity, 0);
    },

    addItem(product, quantity, size) {
      // Add item logic
    },

    removeItem(index) {
      // Remove item logic
    },

    clearCart() {
      // Clear cart logic
    }
  };
}
```

---

## 4. Performance Architecture

### 4.1 Build-time Optimizations

#### Astro Build Process
```javascript
// astro.config.mjs
export default defineConfig({
  output: 'static',
  build: {
    format: 'file',
  },
  vite: {
    build: {
      rollupOptions: {
        output: {
          manualChunks: {
            vendor: ['swiper'],
            styles: ['tailwindcss']
          }
        }
      }
    }
  }
});
```

#### Image Optimization
```typescript
// Image optimization strategy
const imageConfig = {
  formats: ['webp', 'avif', 'jpg'],
  widths: [320, 640, 768, 1024, 1280, 1536],
  quality: 80,
  loading: 'lazy'
};
```

### 4.2 Runtime Optimizations

#### Lazy Loading Strategy
```javascript
// IntersectionObserver for images
const imageObserver = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      const img = entry.target;
      img.src = img.dataset.src;
      img.removeAttribute('data-src');
      imageObserver.unobserve(img);
    }
  });
}, {
  rootMargin: '50px 0px',
  threshold: 0.01
});
```

#### Critical CSS Inlining
```typescript
// Critical CSS for above-the-fold content
const criticalCSS = `
  .main-header { /* header styles */ }
  .product-grid { /* product grid styles */ }
  .hero-section { /* hero styles */ }
`;
```

---

## 5. Integration Architecture

### 5.1 Third-party Service Integration

#### Google Forms Integration
```javascript
// Google Forms field mapping
const formFields = {
  email: 'entry.2094235710',
  name: 'entry.1045781291',
  phone: 'entry.1166974658',
  whatsapp: 'entry.1065045976',
  address: 'entry.2005620554',
  city: 'entry.1861255158',
  postalCode: 'entry.1045728862',
  province: 'entry.449334602',
  cartSummary: 'entry.1209868979',
  paymentMethod: 'entry.1476424229'
};

// Form submission
function submitForm(formData) {
  const form = new FormData();
  Object.entries(formData).forEach(([key, value]) => {
    form.append(formFields[key], value);
  });

  fetch('https://docs.google.com/forms/d/e/1FAIpQLSd_KUORaRPQHoCM6B0GGp_fqI5eiAH0KM2Iwj1mXTgGEjawnQ/formResponse', {
    method: 'POST',
    body: form
  });
}
```

#### Facebook Pixel Integration
```javascript
// Facebook Pixel configuration
window.fbq('init', '1052677351596434');
window.fbq('track', 'PageView');

// E-commerce events
function trackAddToCart(product) {
  fbq('track', 'AddToCart', {
    content_name: product.name,
    content_ids: [product.id],
    value: product.price,
    currency: 'ARS'
  });
}
```

### 5.2 Chrome DevTools MCP Integration

#### Testing Automation
```javascript
// Chrome DevTools automation commands
const testingCommands = {
  takeScreenshot: (path) => {
    // Screenshot automation
  },
  measurePerformance: () => {
    // Core Web Vitals measurement
  },
  validateForm: (formSelector) => {
    // Form validation
  },
  testResponsive: () => {
    // Responsive testing
  }
};
```

---

## 6. Security Architecture

### 6.1 Client-Side Security

#### Form Validation
```javascript
// HTML5 + JavaScript validation
const validationRules = {
  email: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
  phone: /^[0-9]{10}$/,
  whatsapp: /^[0-9]{10}$/,
  postalCode: /^[0-9]{4}$/,
  dni: /^[0-9]{7,8}$/
};
```

#### Data Sanitization
```javascript
// Input sanitization
function sanitizeInput(input) {
  return input
    .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
    .trim();
}
```

### 6.2 Privacy and Data Protection

#### LocalStorage Management
```javascript
// Secure localStorage handling
const storageConfig = {
  cartKey: 'rosita-cart',
  userDataKey: 'rosita-user-data',
  encryptionEnabled: false, // Consider for sensitive data

  // Data expiration
  defaultExpiration: 7 * 24 * 60 * 60 * 1000, // 7 days

  // Storage limits
  maxSize: 5 * 1024 * 1024 // 5MB
};
```

---

## 7. Deployment Architecture

### 7.1 Build Process

#### Static Site Generation
```bash
# Build command
npm run build

# Output structure
dist/
├── index.html              # Main funnel page
├── cart/                   # Static assets
│   ├── index.html
│   └── assets/
├── products/               # Product pages
│   ├── guillerminas/
│   └── birks/
└── assets/                 # Optimized assets
    ├── images/
    ├── css/
    └── js/
```

#### Asset Optimization
```javascript
// Asset pipeline
const assetPipeline = {
  images: {
    formats: ['webp', 'avif', 'jpg'],
    compression: 'lossless',
    responsive: true
  },
  css: {
    minification: true,
    purging: true,
    critical: true
  },
  js: {
    minification: true,
    treeshaking: true,
    codeSplitting: true
  }
};
```

### 7.2 Production Environment

#### Hosting Configuration
```yaml
# Example hosting config (Vercel)
buildCommand: "npm run build"
outputDirectory: "dist"
framework: "astro"
functions: {}
redirects: []
headers:
  - source: "/images/(.*)"
    headers:
      Cache-Control: "public, max-age=31536000, immutable"
  - source: "/(.*\\.(css|js))"
    headers:
      Cache-Control: "public, max-age=31536000, immutable"
```

---

## 8. Monitoring and Analytics

### 8.1 Performance Monitoring

#### Core Web Vitals
```javascript
// Performance monitoring setup
const vitalsObserver = new PerformanceObserver((list) => {
  const entries = list.getEntries();
  entries.forEach(entry => {
    if (entry.entryType === 'largest-contentful-paint') {
      console.log('LCP:', entry.startTime);
    }
  });
});

vitalsObserver.observe({entryTypes: ['largest-contentful-paint', 'first-input', 'layout-shift']});
```

### 8.2 Business Analytics

#### Custom Events Tracking
```javascript
// Custom event tracking
function trackEcommerceEvent(eventName, data) {
  // Google Analytics 4
  gtag('event', eventName, {
    event_category: 'ecommerce',
    event_label: data.productName,
    value: data.value
  });

  // Facebook Pixel
  fbq('trackCustom', eventName, data);
}
```

---

## 9. Technical Debt and Future Improvements

### 9.1 Current Technical Debt
- **No Server-Side Rendering**: Client-side only
- **Limited Error Handling**: Basic error states only
- **No Offline Support**: Requires internet connection
- **Basic SEO Optimization**: Could be enhanced

### 9.2 Future Architecture Improvements
- **Server-Side Components**: For critical above-the-fold content
- **Progressive Web App**: Offline support and app-like experience
- **Advanced Analytics**: Enhanced conversion tracking
- **A/B Testing Framework**: For conversion optimization
- **Headless CMS**: For content management
- **CDN Integration**: Global content delivery

---

## 10. Documentation and Maintenance

### 10.1 Code Documentation
- **JSDoc Comments**: All functions and classes documented
- **TypeScript Types**: Complete type definitions
- **Component Documentation**: Usage examples and props
- **Architecture Decisions**: Rationale behind technical choices

### 10.2 Maintenance Procedures
- **Regular Updates**: Dependencies and security patches
- **Performance Audits**: Monthly Core Web Vitals checks
- **Code Reviews**: Peer review for all changes
- **Testing Updates**: Regular test suite updates
- **Documentation Updates**: Keep docs current with changes

---

*This technical architecture document provides the foundation for the Rosita Rococó e-commerce funnel migration to Astro with performance optimization, scalability, and maintainability considerations.*