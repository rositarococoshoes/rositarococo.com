import"https://unpkg.com/embla-carousel-autoplay@8.3.1/embla-carousel-autoplay.umd.js";import"https://unpkg.com/embla-carousel@8.3.1/embla-carousel.umd.js";const g={ORDER:"https://sswebhookss.odontolab.co/webhook/a5dcd3c9-48a3-46a1-a781-475737a634ca",CONTRAREEMBOLSO:"https://sswebhookss.odontolab.co/webhook/1e214d4e-5481-4ded-8936-c63ff9ce7743",MERCADOPAGO:"https://sswebhookss.odontolab.co/webhook/addaa0c8-96b1-4d63-b2c0-991d6be3de30",FACEBOOK:"https://sswebhookss.odontolab.co/webhook/9dfb840b-2a21-4277-8aec-1666bfaaac89"};async function F(){try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip}catch{return""}}function T(e){const o=`; ${document.cookie}`.split(`; ${e}=`);return o.length===2&&o.pop()?.split(";").shift()||""}function v(){return{fbc:T("_fbc")||localStorage.getItem("facebook_fbc")||"",fbp:T("_fbp")||localStorage.getItem("facebook_fbp")||""}}async function R(e){if(!e)return"";const o=new TextEncoder().encode(e.toLowerCase().trim()),n=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(n)).map(a=>a.toString(16).padStart(2,"0")).join("")}async function O(e,t={}){try{const o=`fb_${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,n=v(),a=await F(),r=document.getElementById("1465946249")?.value||"",s={event_name:e,event_id:o,event_time:Math.floor(Date.now()/1e3),action_source:"website",event_source_url:window.location.href,user_data:{client_ip_address:a,client_user_agent:navigator.userAgent,em:await R(r),fbc:n.fbc,fbp:n.fbp},custom_data:t};await fetch(g.FACEBOOK,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:[s]})}),typeof fbq<"u"&&fbq("track",e,t,{eventID:o})}catch(o){console.error("Facebook tracking error:",o)}}function H(){const e=t=>document.getElementById(t)?.value||"";return{"entry.1471599855":V(),"entry.1460904554":e("1460904554"),"entry.53830725":e("53830725"),"entry.1465946249":e("1465946249"),"entry.951592426":e("951592426"),"entry.1743418466":e("1743418466"),"entry.1005165410":e("1005165410"),"entry.59648134":e("59648134"),"entry.541001873":e("541001873"),"entry.1209868979":window.location.href,comoabona:e("comoabona"),"entry.978809450":e("link-mercadopago"),"entry.2315500325":"A DOMICILIO","entry.17650825":"A DOMICILIO",client_user_agent:navigator.userAgent,_fbp:v().fbp}}function V(){return!window.cart||window.cartCount===0?"":window.cart.map(e=>`${e.size}-${e.model}`).join(", ")}function $(e){let t=window.cartCount===1?6e4:95e3,o=e==="cbu"?Math.round(t*.9):t;return{baseTotal:t,finalTotal:o}}function z(){document.querySelector(".loading-overlay")?.classList.add("active")}function U(){document.querySelector(".loading-overlay")?.classList.remove("active")}function G(){const e=document.getElementById("botoncomprar");e&&(e.disabled=!0,e.textContent="Procesando...")}function J(){const e=document.getElementById("botoncomprar");e&&(e.disabled=!1,e.textContent="Confirmar y Pagar üõí")}async function K(e){if(!(await fetch(g.CONTRAREEMBOLSO,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw new Error("Webhook error");const o=window.cartCount===1?"/gracias-1par-c":"/gracias-2pares-c";window.location.href=o}async function X(e){const{finalTotal:t}=$("tarjeta"),o=v(),a=await(await fetch(g.MERCADOPAGO,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({comprador:e["entry.1460904554"],monto:t,fbp:o.fbp})})).json(),r=Array.isArray(a)?a[0]?.linkpersonalizadomp:a?.linkpersonalizadomp;if(!r)throw new Error("No MercadoPago URL");await _(e),window.location.href=r}async function Q(e){await _(e);const t=window.cartCount>=2?"/transferenciacbu-2pares":"/transferenciacbu-1par";window.location.href=t}async function _(e){const t=new URLSearchParams;Object.entries(e).forEach(([o,n])=>{n&&t.append(o,n)}),await fetch(g.ORDER,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t.toString()})}function Y(){const e=["1460904554","53830725","1465946249","951592426","1743418466","1005165410","59648134"];for(const o of e){const n=document.getElementById(o);if(!n?.value?.trim())return f("Por favor completa todos los campos obligatorios","error"),n?.focus(),!1}return window.cartCount===0?(f("Debes agregar al menos un producto","error"),!1):document.getElementById("comoabona")?.value?!0:(f("Por favor selecciona un m√©todo de pago","error"),!1)}function f(e,t="error"){const o=document.getElementById("notification-container");if(!o)return;const n=document.createElement("div");n.className=`${t==="error"?"bg-red-100 border-red-400 text-red-800":"bg-green-100 border-green-400 text-green-800"} border-l-4 p-4 rounded shadow-lg`,n.innerHTML=`<p class="font-medium">${e}</p>`,o.appendChild(n),setTimeout(()=>n.remove(),5e3)}async function Z(e){if(e.preventDefault(),!!Y()){z(),G();try{const t=document.getElementById("comoabona").value,o=H(),{finalTotal:n}=$(t);switch(await O("InitiateCheckout",{content_type:"product",value:n,currency:"ARS",num_items:window.cartCount}),t){case"contrareembolso":await K(o);break;case"tarjeta":case"mercadopago":await X(o);break;case"cbu":await Q(o);break;default:throw new Error("M√©todo de pago no v√°lido")}}catch(t){console.error("Order error:",t),f("Hubo un problema al procesar tu pedido. Intenta nuevamente.","error"),U(),J()}}}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("bootstrapForm")?.addEventListener("submit",Z);const t=document.getElementById("1209868979");t&&(t.value=window.location.href),O("PageView")});function ee(){if(typeof EmblaCarousel>"u"){console.error("EmblaCarousel not loaded");return}document.querySelectorAll(".embla").forEach((t,o)=>{const n=t.querySelector(".embla__viewport");if(n)try{const a=EmblaCarousel(n,{align:"start",containScroll:"keepSnaps",dragFree:!1,loop:!0}),r=t.querySelector(".embla__button--prev"),s=t.querySelector(".embla__button--next");r?.addEventListener("click",()=>a.scrollPrev()),s?.addEventListener("click",()=>a.scrollNext());const u=t.querySelector(".embla-thumbs");if(u){const I=u.querySelector(".embla-thumbs__viewport");if(I){const S=EmblaCarousel(I,{containScroll:"keepSnaps",dragFree:!0}),L=u.querySelectorAll(".embla-thumbs__slide");L.forEach((p,h)=>{p.addEventListener("click",()=>{a.scrollTo(h)})});const B=()=>{const p=a.selectedScrollSnap();L.forEach((h,q)=>{h.classList.toggle("embla-thumbs__slide--selected",q===p)}),S.scrollTo&&S.scrollTo(p)};a.on("select",B),B()}}console.log(`Carousel ${o} initialized`)}catch(a){console.error(`Error initializing carousel ${o}:`,a)}})}document.addEventListener("DOMContentLoaded",()=>{setTimeout(ee,500)});const c="/astro-ecommerce",M={negras:{name:"Guillerminas Negras",price:6e4,image:`${c}/guillerminafotos/1.webp`},camel:{name:"Guillerminas Camel",price:6e4,image:`${c}/guillerminafotos/guillerminascamel/1.webp`},blancas:{name:"Guillerminas Blancas",price:6e4,image:`${c}/guillerminafotos/guillerminasblancas/1.webp`},"birk-negras":{name:"Birk Negras",price:6e4,image:`${c}/birknegras/1.webp`},"birk-camel":{name:"Birk Camel",price:6e4,image:`${c}/birkcamel/1.webp`},"birk-blancas":{name:"Birk Blancas",price:6e4,image:`${c}/birkblancas/1.webp`},argos:{name:"Argos",price:6e4,image:`${c}/argos/1.webp`}};typeof window<"u"&&(window.cart=window.cart||[],window.cartCount=window.cartCount||0,window.isCartOpen=window.isCartOpen||!1);function P(e,t){if(!t){i("Por favor selecciona un talle","warning");return}if(!M[e]){i("Producto no encontrado","error");return}if(window.cartCount>=2){i("‚ö†Ô∏è L√≠mite alcanzado: Solo puedes agregar m√°ximo 2 pares por pedido","warning");return}const n=localStorage.getItem("whatsappModalShown");if(window.cartCount===0&&!n&&typeof window.showWhatsappModal=="function"){window.pendingCartAdd={model:e,size:t},window.showWhatsappModal();return}N(e,t)}function N(e,t){const o=M[e];if(!o)return;const n={id:Date.now(),model:e,name:o.name,size:t,price:o.price,image:o.image};window.cart.push(n),window.cartCount++,b(),window.cartCount===1?(i("‚úÖ ¬°Agreg√° un segundo par para activar el descuento de $25.000!","success"),y()):window.cartCount===2&&(i("üéâ ¬°Promoci√≥n activada! 2 pares por $95.000 - Complet√° tus datos","success"),y(),setTimeout(()=>{E()},1500))}function te(e){window.cart=window.cart.filter(t=>t.id!==e),window.cartCount=window.cart.length,b(),window.cartCount===0?i("üõí Carrito vac√≠o","info"):window.cartCount===1&&i("‚úÖ Agreg√° otro par para activar descuento","warning")}function W(){return window.cartCount===0?0:window.cartCount===1?6e4:95e3}function b(){document.querySelectorAll(".cart-count, .cart-button-count").forEach(s=>{s.textContent=String(window.cartCount)});const e=document.querySelector(".cart-items"),t=document.querySelector(".empty-cart-message");e&&(window.cartCount===0?(e.innerHTML="",t&&(t.style.display="block")):(t&&(t.style.display="none"),e.innerHTML=window.cart.map(s=>`
        <div class="cart-item bg-gray-50 p-3 rounded-lg relative" data-item-id="${s.id}">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3 flex-1">
              <img src="${s.image}" alt="${s.name}" class="w-12 h-12 object-cover rounded">
              <div>
                <h4 class="font-semibold text-sm">${s.name}</h4>
                <p class="text-xs text-gray-600">Talle: ${s.size}</p>
              </div>
            </div>
            <button class="remove-item text-red-500 hover:text-red-700 text-xl font-bold" onclick="removeFromCart(${s.id})">√ó</button>
          </div>
        </div>
      `).join("")));const o=W();document.querySelectorAll(".cart-total span").forEach(s=>{s.textContent=`$${o.toLocaleString("es-AR")}`});const n=document.getElementById("checkout-btn");n&&(window.cartCount===0?(n.disabled=!0,n.className="bg-gray-400 text-white px-4 py-2 rounded-lg cursor-not-allowed"):(n.disabled=!1,n.className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 cursor-pointer"));const a=document.getElementById("cart-offer-message");a&&a.classList.toggle("hidden",window.cartCount!==1);const r=document.getElementById("restodelform");r&&(r.classList.toggle("hidden",window.cartCount===0),window.cartCount>0?r.classList.add("has-items"):r.classList.remove("has-items")),oe()}function oe(){const e=document.getElementById("286442883");e&&window.cartCount>0&&(e.value=window.cart.map(o=>`${o.name} - Talle ${o.size}`).join(", "));const t=document.getElementById("preciototal");if(t){const o=W();t.innerHTML=window.cartCount>0?`<strong>Total: $${o.toLocaleString("es-AR")}</strong>`:"Elige modelos y talles para ver el total"}}function y(){const e=document.getElementById("mini-cart"),t=document.getElementById("cart-backdrop");e&&(window.isCartOpen=!0,e.classList.add("open"),e.style.transform="translateX(0)",e.style.opacity="1",e.style.pointerEvents="auto"),t&&t.classList.remove("hidden")}function w(){const e=document.getElementById("mini-cart"),t=document.getElementById("cart-backdrop");e&&(window.isCartOpen=!1,e.classList.remove("open"),e.style.transform="translateX(100%)",e.style.opacity="0",e.style.pointerEvents="none"),t&&t.classList.add("hidden")}function ne(){window.isCartOpen?w():y()}function E(){if(window.cartCount===0){i("Debes agregar productos antes de continuar","warning");return}w(),setTimeout(()=>{const e=document.getElementById("restodelform"),t=document.getElementById("datos-envio");e&&(e.classList.remove("hidden"),(t||e).scrollIntoView({behavior:"smooth",block:"start"}),ae(2),i("‚úÖ ¬°Completa tus datos de env√≠o!","success"))},300)}function ae(e){document.querySelectorAll(".progress-step").forEach((t,o)=>{const n=o+1,a=t.querySelector(".step-number"),r=t.querySelector(".step-name");a&&r&&(n<e?(a.className="step-number bg-green-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm mb-1",r.className="step-name text-sm font-medium text-green-600 text-center"):n===e?(a.className="step-number bg-pink-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm mb-1",r.className="step-name text-sm font-medium text-center"):(a.className="step-number bg-gray-300 text-gray-600 w-8 h-8 rounded-full flex items-center justify-center text-sm mb-1",r.className="step-name text-sm font-medium text-gray-600 text-center"))})}function j(e){const t=e.getAttribute("data-model");if(!t)return;const o=`talle-${t}`,a=e.closest(".product-card")?.querySelector(`#${o}`)||document.getElementById(o);if(a){const s=a.options[a.selectedIndex]?.value;s&&s!==""?P(t,s):i("Por favor selecciona un talle","warning")}}function i(e,t="info"){const o=document.getElementById("notification-container");if(!o)return;const n=document.createElement("div"),a={info:"bg-blue-100 border-blue-400 text-blue-800",success:"bg-green-100 border-green-400 text-green-800",warning:"bg-yellow-100 border-yellow-400 text-yellow-800",error:"bg-red-100 border-red-400 text-red-800"};n.className=`${a[t]} border-l-4 p-4 rounded shadow-lg animate-fade-in`,n.innerHTML=`
    <div class="flex items-center justify-between">
      <p class="font-medium">${e}</p>
      <button class="ml-4 text-lg font-bold hover:opacity-70" onclick="this.parentElement.parentElement.remove()">√ó</button>
    </div>
  `,o.appendChild(n),setTimeout(()=>n.remove(),4e3)}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("cart-button")?.addEventListener("click",ne),document.querySelector(".cart-close")?.addEventListener("click",w),document.getElementById("cart-backdrop")?.addEventListener("click",w),document.getElementById("checkout-btn")?.addEventListener("click",E),document.querySelectorAll(".add-to-cart-btn").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),j(e)})}),b()});typeof window<"u"&&(window.addToCart=P,window.removeFromCart=te,window.handleAddToCart=j,window.goToCheckoutForm=E,window.updateCartUI=b,window.confirmAddToCart=N);const d="/astro-ecommerce",re=[{src:`${d}/comentarios/comentario1-min.webp`,alt:"Testimonio destacado 1"},{src:`${d}/comentarios/comentario2-min.webp`,alt:"Testimonio destacado 2"},{src:`${d}/comentarios/comentario3-min.webp`,alt:"Referencia de clienta 1"},{src:`${d}/comentarios/comentario4-min.webp`,alt:"Referencia de clienta 2"},{src:`${d}/comentarios/comentario5-min.webp`,alt:"Referencia de clienta 3"},{src:`${d}/comentarios/comentariorecibi7.webp`,alt:"Comentario adicional"}];let A=!1;document.getElementById("load-more-testimonials")?.addEventListener("click",function(){if(A)return;const e=document.getElementById("testimonials-grid"),t=this,o=document.getElementById("testimonials-loading");t.style.display="none",o&&o.classList.remove("hidden"),setTimeout(()=>{re.forEach(n=>{const a=document.createElement("div");a.className="testimonial-item bg-white rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-all duration-300",a.innerHTML=`<img src="${n.src}" alt="${n.alt}" class="w-full h-auto object-cover" loading="lazy">`,e?.appendChild(a)}),o&&o.classList.add("hidden"),A=!0},800)});const se="https://sswebhookss.odontolab.co/webhook/02eb0643-1b9d-4866-87a7-f892d6a945ea",ie="https://sswebhookss.odontolab.co/webhook/1d018fb5-b798-4218-9c57-b48e3a71c6a7";let m=!1;function D(e){if(!e)return"";let t=e.replace(/[\s\-()]/g,"");return t.startsWith("+54")&&(t=t.substring(3)),t.startsWith("54")&&(t=t.substring(2)),t.startsWith("0")&&(t=t.substring(1)),t.startsWith("15")&&t.length>2&&(t=t.substring(2)),/^\d+$/.test(t)?"549"+t:""}function C(e){return D(e).length>=12}function l(e,t="error"){const o=document.getElementById("whatsapp-error-message");o&&(o.textContent=e,o.className="whatsapp-error-message",t!=="error"&&o.classList.add(t))}function ce(e){fetch(ie,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({whatsapp:e,timestamp:new Date().toISOString(),source:"astro_modal_whatsapp",url:window.location.href})}).catch(t=>console.error("Error saving WhatsApp:",t))}async function x(){const e=document.getElementById("whatsapp-modal-input"),t=document.getElementById("whatsapp-modal-submit");if(!e||!t||m)return;const o=e.value.trim();if(!C(o)){l("Formato de WhatsApp invalido. Ej: 1156457057"),e.classList.add("error"),e.classList.remove("success");return}m=!0,t.disabled=!0,l("Verificando WhatsApp...","verifying");const n=D(o),a=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";try{let r=!1;if(a)r=!0;else{const s=await fetch(se,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({whatsapp_check:n})});if(!s.ok)throw new Error("API error");r=(await s.json()).exists===!0}if(r){l("WhatsApp valido. Gracias!","valid"),e.classList.remove("error"),e.classList.add("success"),a||ce(n),localStorage.setItem("savedWhatsapp",n),localStorage.setItem("whatsappModalShown","true");const s=document.getElementById("53830725");s&&(s.value=n),setTimeout(()=>{k(),window.pendingCartAdd&&(window.confirmAddToCart(window.pendingCartAdd.model,window.pendingCartAdd.size),window.pendingCartAdd=null)},800)}else l("WhatsApp invalido, por favor corrijalo."),e.classList.add("error"),e.classList.remove("success"),m=!1,t.disabled=!1}catch(r){console.error("WhatsApp validation error:",r),l("Error de red. Intenta de nuevo."),m=!1,t.disabled=!1}}function k(){const e=document.getElementById("whatsapp-modal");e&&e.classList.remove("active"),m=!1}function de(){const e=document.getElementById("whatsapp-modal"),t=document.getElementById("whatsapp-modal-input"),o=document.getElementById("whatsapp-modal-submit");e&&(e.classList.add("active"),t&&(t.value=localStorage.getItem("savedWhatsapp")||"",t.classList.remove("error","success"),o&&(o.disabled=!C(t.value))),l(""))}window.showWhatsappModal=de;window.closeWhatsappModal=k;window.pendingCartAdd=null;document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("whatsapp-modal-input"),t=document.getElementById("whatsapp-modal-submit"),o=document.querySelector(".whatsapp-modal-overlay");e&&t&&(e.addEventListener("input",n=>{const a=n.target,r=C(a.value.trim());t.disabled=!r,r&&a.classList.remove("error")}),e.addEventListener("keypress",n=>{n.key==="Enter"&&!t.disabled&&x()})),document.getElementById("whatsapp-modal-submit")?.addEventListener("click",x),o?.addEventListener("click",()=>{window.pendingCartAdd&&(window.pendingCartAdd=null),k()})});
