<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Google Tag Manager REMOVIDO - Ahora usando Facebook Pixel directo -->

    <!-- Facebook Pixel Code -->
    <script>
    console.log('üîµ Iniciando carga de Facebook Pixel (Contrareembolso)...');

    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');

    console.log('üîµ Facebook Pixel script insertado');

    // Verificar que fbq est√© disponible
    if (typeof fbq !== 'undefined') {
        console.log('‚úÖ fbq est√° disponible');
        fbq('init', '1052677351596434');
        console.log('‚úÖ Facebook Pixel inicializado con ID: 1052677351596434');
        fbq('track', 'PageView');
        console.log('‚úÖ PageView event enviado');
    } else {
        console.error('‚ùå fbq no est√° disponible');
    }

    // Verificar cuando el script se carga
    window.addEventListener('load', function() {
        console.log('üîµ P√°gina cargada completamente');
        if (typeof fbq !== 'undefined') {
            console.log('‚úÖ Facebook Pixel confirmado despu√©s de load');
        } else {
            console.error('‚ùå Facebook Pixel NO disponible despu√©s de load');
        }
    });
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1052677351596434&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Facebook Pixel Code -->

    <script>
        // Variable global para identificar esta p√°gina como de contrareembolso
        var IS_CONTRAREEMBOLSO_PAGE = true;
    </script>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Rosita Rococ√≥ - Colecci√≥n Oto√±o-Invierno 2025</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Descubre nuestra exclusiva colecci√≥n oto√±o-invierno de calzado femenino. Dise√±os elegantes y c√≥modos con env√≠o gratis a todo el pa√≠s.">

    <!-- Preconexiones para mejorar velocidad -->
    <link rel="preconnect" href="https://connect.facebook.net">
    <link rel="preconnect" href="https://www.facebook.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Preload de recursos cr√≠ticos -->
    <link rel="preload" href="rosita-form.webp" as="image">


    <!-- Fonts con carga optimizada -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Lato:wght@300;400;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Lato:wght@300;400;700&display=swap">
    </noscript>

    <!-- Carousel CSS con preload para mejorar rendimiento -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" as="style">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">

    <!-- Custom CSS con preload para mejorar rendimiento -->
    <link rel="preload" href="otono-elegante2.css" as="style">
    <link rel="stylesheet" href="otono-elegante2.css">

    <!-- Swiper Custom CSS -->
    <link rel="preload" href="swiper-custom.css" as="style">
    <link rel="stylesheet" href="swiper-custom.css" />

    <!-- Badges and Prices CSS -->
    <link rel="preload" href="badges.css" as="style">
    <link rel="stylesheet" href="badges.css" />

    <!-- Price and Quantity Selector CSS -->
    <link rel="preload" href="price-quantity.css" as="style">
    <link rel="stylesheet" href="price-quantity.css" />

    <!-- Floating Button CSS -->
    <link rel="preload" href="floating-button.css" as="style">
    <link rel="stylesheet" href="floating-button.css" />

    <!-- Chat Widget CSS -->
    <link rel="preload" href="chat-widget.css" as="style">
    <link rel="stylesheet" href="chat-widget.css" />

    <!-- Header Improvements CSS -->
    <link rel="preload" href="header-improvements.css" as="style">
    <link rel="stylesheet" href="header-improvements.css" />

    <!-- WhatsApp Modal CSS -->
    <style>
        .whatsapp-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            font-family: 'Lato', sans-serif;
        }

        .whatsapp-modal.active {
            display: block;
        }

        .whatsapp-modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(3px);
        }

        .whatsapp-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            width: 90%;
            max-width: 400px;
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -60%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .whatsapp-modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .whatsapp-modal-header h3 {
            margin: 0;
            font-size: 1.2rem;
            color: #333;
            font-weight: 600;
        }

        .whatsapp-modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            padding: 0;
            line-height: 1;
        }

        .whatsapp-modal-body {
            padding: 20px;
        }

        .whatsapp-modal-message {
            margin-top: 0;
            margin-bottom: 15px;
            color: #555;
            font-size: 0.95rem;
        }

        .whatsapp-form-group {
            margin-bottom: 15px;
        }

        .whatsapp-form-group input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .whatsapp-form-group input:focus {
            border-color: #a05941;
            outline: none;
        }

        .whatsapp-error-message {
            color: #e74c3c;
            font-size: 0.85rem;
            margin-top: 5px;
            min-height: 20px;
        }

        .whatsapp-error-message.valid {
            color: #27ae60;
        }

        .whatsapp-modal-button {
            width: 100%;
            padding: 12px;
            background-color: #a05941;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .whatsapp-modal-button:hover {
            background-color: #8a4a38;
        }

        .whatsapp-modal-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .whatsapp-modal-note {
            margin-top: 15px;
            color: #777;
            font-size: 0.8rem;
            text-align: center;
        }

        /* Cart Messages Area - Professional Styles */
        #cart-messages {
            position: relative;
            z-index: 10;
            pointer-events: auto;
        }

        /* √Årea de mensajes principal */
        .cart-messages-area {
            background: rgba(248, 249, 250, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(222, 226, 230, 0.8);
            padding: 16px 20px;
            min-height: 24px;
            font-size: 0.9rem;
            line-height: 1.5;
            color: #495057;
            position: relative;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .cart-messages-area:empty {
            display: none;
            opacity: 0;
            transform: translateY(-10px);
        }

        .cart-messages-area:not(:empty) {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Mensajes individuales */
        .cart-message {
            position: relative;
            display: flex;
            align-items: center;
            padding: 14px 16px;
            margin-bottom: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: slideInMessage 0.4s ease-out;
            backdrop-filter: blur(5px);
        }

        .cart-message:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        @keyframes slideInMessage {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Texto del mensaje */
        .message-text {
            flex-grow: 1;
            font-weight: 500;
            line-height: 1.4;
        }

        /* Bot√≥n de cierre */
        .message-close {
            position: absolute;
            top: 8px;
            right: 12px;
            background: transparent;
            border: none;
            font-size: 18px;
            color: rgba(0, 0, 0, 0.4);
            cursor: pointer;
            padding: 4px;
            border-radius: 50%;
            transition: all 0.2s ease;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .message-close:hover {
            background: rgba(0, 0, 0, 0.1);
            color: rgba(0, 0, 0, 0.7);
            transform: scale(1.1);
        }

        /* Tipos de mensaje espec√≠ficos */
        .cart-message-success {
            background: linear-gradient(135deg, rgba(212, 237, 218, 0.95), rgba(193, 230, 198, 0.95));
            border-left: 4px solid #28a745;
            color: #155724;
        }

        .cart-message-info {
            background: linear-gradient(135deg, rgba(209, 236, 241, 0.95), rgba(190, 229, 235, 0.95));
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }

        .cart-message-warning {
            background: linear-gradient(135deg, rgba(255, 243, 205, 0.95), rgba(255, 235, 186, 0.95));
            border-left: 4px solid #ffc107;
            color: #856404;
        }

        .cart-message-error {
            background: linear-gradient(135deg, rgba(248, 215, 218, 0.95), rgba(241, 196, 200, 0.95));
            border-left: 4px solid #dc3545;
            color: #721c24;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .cart-messages-area {
                padding: 12px 16px;
                font-size: 0.85rem;
                border-radius: 0 0 8px 8px;
            }

            .cart-message {
                padding: 12px 14px;
                margin-bottom: 10px;
                font-size: 0.85rem;
            }

            .message-close {
                top: 6px;
                right: 10px;
                font-size: 16px;
                width: 20px;
                height: 20px;
            }
        }

        @media (max-width: 480px) {
            .cart-messages-area {
                padding: 10px 12px;
                font-size: 0.8rem;
            }

            .cart-message {
                padding: 10px 12px;
                margin-bottom: 8px;
            }

            .message-text {
                font-size: 0.8rem;
            }
        }

        /* Testimonials Section Redesign */
        .testimonials-section {
            padding: 60px 20px;
            background: linear-gradient(135deg, #faf8f5 0%, #f5f1eb 100%);
            margin: 40px 0;
        }

        .testimonials-section h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            color: #2c1810;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .testimonials-subtitle {
            color: #8b6f47;
            font-size: 1.1rem;
            margin-bottom: 50px;
            text-align: center;
            font-style: italic;
        }

        .testimonials-grid {
            /* Masonry layout usando CSS columns */
            columns: 3;
            column-gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .testimonial-item {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 0.6s ease forwards;
            /* Masonry layout */
            break-inside: avoid;
            margin-bottom: 20px;
            display: inline-block;
            width: 100%;
            position: relative;
        }

        /* Efecto de overlay sutil en hover */
        .testimonial-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(139, 111, 71, 0.1), rgba(166, 124, 82, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: 15px;
            z-index: 1;
        }

        .testimonial-item:hover::before {
            opacity: 1;
        }

        .testimonial-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.12);
        }

        .testimonial-item img {
            width: 100%;
            height: auto;
            display: block;
            transition: transform 0.3s ease;
            border-radius: 15px;
        }

        .testimonial-item:hover img {
            transform: scale(1.02);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Staggered animation for testimonials - m√°s sutil para masonry */
        .testimonial-item:nth-child(3n+1) { animation-delay: 0.1s; }
        .testimonial-item:nth-child(3n+2) { animation-delay: 0.2s; }
        .testimonial-item:nth-child(3n+3) { animation-delay: 0.3s; }

        /* Loading indicator */
        .testimonials-loading {
            text-align: center;
            padding: 40px 20px;
            display: none;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #8b6f47;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .testimonials-loading p {
            color: #8b6f47;
            font-style: italic;
        }

        /* Back to products button */
        .back-to-products {
            text-align: center;
            padding: 40px 20px;
            margin-top: 30px;
        }

        .btn-back-to-products {
            background: linear-gradient(135deg, #8b6f47 0%, #a67c52 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(139, 111, 71, 0.3);
            margin-bottom: 10px;
        }

        .btn-back-to-products:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 111, 71, 0.4);
            background: linear-gradient(135deg, #a67c52 0%, #8b6f47 100%);
        }

        .back-to-products-text {
            color: #8b6f47;
            font-style: italic;
            margin-top: 10px;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .testimonials-section {
                padding: 40px 15px;
            }

            .testimonials-section h2 {
                font-size: 2rem;
            }

            .testimonials-grid {
                columns: 2;
                column-gap: 15px;
                padding: 0 10px;
            }

            .testimonial-item {
                margin-bottom: 15px;
            }

            .testimonials-subtitle {
                font-size: 1rem;
                margin-bottom: 30px;
            }
        }

        @media (max-width: 480px) {
            .testimonials-grid {
                columns: 1;
                column-gap: 0;
                padding: 0 5px;
            }

            .testimonial-item {
                margin-bottom: 15px;
            }

            .testimonials-section h2 {
                font-size: 1.8rem;
            }
        }

        /* Size Guide Styles */
        .size-guide-container {
            margin: 20px 0;
            border: 1px solid #eee;
            border-radius: 8px;
            background-color: #f9f9f9;
            overflow: hidden;
        }
        .size-guide-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            cursor: pointer;
            user-select: none;
        }
        .size-guide-toggle h3 {
            margin: 0;
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
        }
        .toggle-icon {
            font-size: 1.5rem;
            font-weight: bold;
            transition: transform 0.3s ease;
        }
        .size-guide-content {
            display: none !important;
            padding: 0 15px 15px;
            border-top: 1px solid #eee;
        }
        .size-guide-container.open .size-guide-content {
            display: block !important;
        }
        .size-guide-container.open .toggle-icon {
            transform: rotate(0deg) !important;
        }
        .size-guide-container table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        .size-guide-container th, .size-guide-container td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        .size-guide-container th {
            background-color: #f2f2f2;
        }
        .size-instructions h4 {
            margin-top: 0;
            margin-bottom: 10px;
        }
        .size-instructions ol {
            padding-left: 20px;
            margin: 0;
        }
        .size-instructions li {
            margin-bottom: 5px;
        }

        /* Fix for fieldset borders in 2 pairs selector */
        .fieldsetstalles {
            border: 1px solid #ddd !important;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            background-color: #fafafa;
        }
        .fieldsetstalles select {
            border: 1px solid #ccc !important;
            border-radius: 4px;
        }
        .fieldsetstalles select:focus {
            border-color: #a05941 !important;
            outline: none;
        }
    </style>

    <!-- Estilos para informaci√≥n de entrega y pago -->
    <style>
        .delivery-info, .payment-method-info {
            margin: 5px 0;
            font-size: 0.9em;
            line-height: 1.3;
        }
        .delivery-badge, .payment-badge {
            display: inline-block;
            font-weight: bold;
            margin-right: 5px;
            color: #a05941;
        }
        .delivery-date {
            text-transform: uppercase;
            font-size: 12px;
        }
        .payment-method-info {
            margin-bottom: 10px;
        }
    </style>

    <!-- Scripts optimizados para carga r√°pida -->
    <!-- Los scripts se cargar√°n al final del documento para mejorar el rendimiento -->

    <!-- Facebook Pixel ya incluido al principio del head -->
</head>
<body>
    <!-- GTM noscript removido - Ahora usando Facebook Pixel directo -->

    <!-- Anti-bot Honeypot Field -->
    <input type="text" name="website" id="website" class="sr-only" tabindex="-1" autocomplete="off">

    <!-- Barra superior de beneficios -->
    <div class="top-benefits-bar">
        <div class="benefit-container">
            <div class="benefit-item">üí∏ PAGAS AL RECIBIR EN EFECTIVO</div>
            <div class="benefit-divider">|</div>
            <div class="benefit-item">üöö ENV√çO GRATIS</div>
        </div>
    </div>

    <!-- Mini Cart -->
    <div id="mini-cart">
        <!-- Cart Messages Area -->
        <div id="cart-messages" class="cart-messages-area">
            <!-- Messages will be dynamically inserted here -->
        </div>
        <div class="mini-cart-header">
            <span class="cart-icon">üõí</span>
            <span class="cart-title">Tu Carrito</span>
            <span class="cart-count">0</span>
            <button class="cart-close">√ó</button>
        </div>
        <div class="mini-cart-body">
            <p class="empty-cart-message">Tu carrito est√° vac√≠o</p>
            <div class="cart-items"></div>
            <div class="cart-instructions">
                <p class="instruction-step"><span class="step-number">1</span> Selecciona tus productos favoritos</p>
                <p class="instruction-step"><span class="step-number">2</span> Revisa tu carrito</p>
                <p class="instruction-step"><span class="step-number">3</span> Haz clic en "Finalizar Compra"</p>
            </div>
        </div>
        <div class="mini-cart-footer">
            <div class="cart-total">Total: <span>$0</span></div>
            <button id="checkout-btn" class="btn-disabled" onclick="goToCheckoutForm()">Continuar al Env√≠o ‚Üí</button>
        </div>
    </div>

    <!-- Bot√≥n de carrito independiente -->
    <div id="cart-button">
        <span class="cart-button-icon">üõí</span>
        <span class="cart-button-count">0</span>
    </div>

    <!-- Bot√≥n flotante de continuar al env√≠o -->
    <button id="fixed-checkout-button" onclick="goToCheckoutForm()">
        <span class="button-content">
            <span>Continuar al Env√≠o</span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </span>
    </button>



    <script>
        // Variables globales para optimizar rendimiento
        var floatingButton = document.getElementById('fixed-checkout-button');
        var formSection = document.getElementById('restodelform');
        var cartCountElement = document.querySelector('.cart-button-count');
        var formTopPosition = formSection ? formSection.offsetTop : 0;
        var lastScrollY = 0;
        var lastItemCount = 0;
        var buttonVisible = false;
        var scrollTimeout = null;

        // Funci√≥n optimizada para ir al formulario de env√≠o
        function goToCheckoutForm() {
            // Verificar si formSection existe
            if (!formSection) {
                formSection = document.getElementById('restodelform');
                if (!formSection) {
                    console.error('Error: No se encontr√≥ el elemento con ID "restodelform"');
                    return;
                }
            }

            // Mostrar la secci√≥n del formulario
            formSection.classList.remove('hidden');
            formSection.classList.add('active');

            // Desplazarse al formulario
            window.scrollTo({
                top: formSection.offsetTop - 20,
                behavior: 'smooth'
            });

            // Verificar si floatingButton existe
            if (floatingButton) {
                // Ocultar el bot√≥n flotante con transici√≥n suave
                floatingButton.style.opacity = '0';
                floatingButton.style.pointerEvents = 'none';
                // Ocultar completamente despu√©s de la transici√≥n
                setTimeout(function() {
                    floatingButton.style.display = 'none';
                }, 300);
                buttonVisible = false;
            }

            // Mostrar notificaci√≥n
            var container = document.getElementById('notification-container');
            if (container) {
                var notification = document.createElement('div');
                notification.className = 'notification info';
                notification.innerHTML = 'Completa tus datos para finalizar la compra';
                container.appendChild(notification);
                setTimeout(function() {
                    if (notification.parentNode) notification.parentNode.removeChild(notification);
                }, 5000);
            }
        }

        // Funci√≥n optimizada para actualizar la visibilidad del bot√≥n flotante
        function updateFloatingButton() {
            // Obtener el contador del carrito
            var itemCount = cartCountElement ? parseInt(cartCountElement.textContent || '0') : 0;
            var scrollY = window.scrollY || window.pageYOffset;

            // Optimizaci√≥n: solo actualizar si algo ha cambiado
            if (itemCount === lastItemCount && scrollY === lastScrollY && formTopPosition) {
                return;
            }

            // Actualizar valores
            lastItemCount = itemCount;
            lastScrollY = scrollY;

            // Obtener el estado del formulario
            var isFormActive = formSection && formSection.classList.contains('active');
            var isAboveForm = scrollY < formTopPosition - 100;

            // Mostrar u ocultar el bot√≥n seg√∫n las condiciones
            var shouldShow = itemCount > 0 && (!isFormActive || isAboveForm);

            if (shouldShow !== buttonVisible) {
                // Usar opacity y pointer-events para una transici√≥n m√°s suave
                if (shouldShow) {
                    floatingButton.style.display = 'flex';
                    // Peque√±o retraso para permitir que la transici√≥n funcione
                    setTimeout(function() {
                        floatingButton.style.opacity = '1';
                        floatingButton.style.pointerEvents = 'auto';
                    }, 10);
                } else {
                    floatingButton.style.opacity = '0';
                    floatingButton.style.pointerEvents = 'none';
                    // Ocultar completamente despu√©s de la transici√≥n
                    setTimeout(function() {
                        floatingButton.style.display = 'none';
                    }, 300);
                }
                buttonVisible = shouldShow;
            }
        }

        // Optimizaci√≥n: usar requestAnimationFrame para el scroll
        window.addEventListener('scroll', function() {
            if (scrollTimeout) return;

            scrollTimeout = requestAnimationFrame(function() {
                updateFloatingButton();
                scrollTimeout = null;
            });
        });

        // Actualizar peri√≥dicamente (menos frecuente para ahorrar recursos)
        setInterval(updateFloatingButton, 2000);

        // Actualizar cuando cambia el carrito
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar posici√≥n del formulario
            formTopPosition = formSection ? formSection.offsetTop : 0;

            // Ejecutar una vez al inicio
            updateFloatingButton();
        });
    </script>

    <!-- Checkout Progress Bar -->
    <div id="checkout-progress">
        <div class="progress-step active" data-step="1">
            <span class="step-number">1</span>
            <span class="step-name">Productos</span>
        </div>
        <div class="progress-connector"></div>
        <div class="progress-step" data-step="2">
            <span class="step-number">2</span>
            <span class="step-name">Env√≠o</span>
        </div>
        <div class="progress-connector"></div>
        <div class="progress-step" data-step="3">
            <span class="step-number">3</span>
            <span class="step-name">Contrareembolso</span>
        </div>
    </div>

    <!-- WhatsApp Button Removed -->

    <div class="container">
        <header class="main-header">
            <div class="promo-banner">üí∏ PAGAS AL RECIBIR EN EFECTIVO | 2 pares por $85.000 ($42.500 c/u)</div>
            <img alt="Rosita Rococ√≥ Logo" src="rosita-form.webp" />

        </header>



        <!-- Form Start -->
        <form action="https://sswebhookss.odontolab.co/webhook/1e214d4e-5481-4ded-8936-c63ff9ce7743" id="bootstrapForm" method="POST" target="_self" novalidate="">

            <!-- Hidden Fields for Google Forms -->
            <textarea id="1209868979" name="entry.1209868979" class="hidden"></textarea>
            <input name="fvv" type="hidden" value="1" />
            <input name="fbzx" type="hidden" value="5661184097173102736" />
            <input name="pageHistory" type="hidden" value="0" />
            <!-- Campos ocultos para contrareembolso.html -->
            <input type="hidden" id="1885018612" name="entry.1885018612" />
            <input type="hidden" id="1715320252" name="entry.1715320252" />
            <input type="hidden" id="736134777" name="entry.736134777" />
            <input type="hidden" id="227154461" name="entry.227154461" />
            <input type="hidden" id="1620487876" name="entry.1620487876" value="Pendiente" />
            <!-- Campo para sincronizaci√≥n con sistema index.html -->
            <input type="hidden" id="1471599855" name="entry.1471599855" />


            <fieldset id="todoslosmodelos">
                <legend class="sr-only">Selecci√≥n de Modelos</legend>


                <div class="product-grid">
                    <!-- PRODUCTO: Mil√°n -->
                    <div class="product-item" id="modeload-milan">

                        <h2>Mil√°n</h2>
                        <div class="swiper" id="swiper-milan">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide"><img alt="Mil√°n - Vista 1" src="nuevosmodeloscontra/1.webp" fetchpriority="high" decoding="async"></div>
                                <div class="swiper-slide"><img alt="Mil√°n - Vista 2" src="nuevosmodeloscontra/2.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Mil√°n - Vista 3" src="nuevosmodeloscontra/3.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Mil√°n - Vista 4" src="nuevosmodeloscontra/4.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Mil√°n - Vista 5" src="nuevosmodeloscontra/5.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Mil√°n - Vista 6" src="nuevosmodeloscontra/6.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Mil√°n - Vista 7" src="nuevosmodeloscontra/7.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Mil√°n - Vista 8" src="nuevosmodeloscontra/8.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Mil√°n - Vista 9" src="nuevosmodeloscontra/9.webp" loading="lazy"></div>
                            </div>
                            <div class="swiper-button-prev"></div>
                            <div class="swiper-button-next"></div>
                        </div>
                        <div class="swiper" id="swiper-thumbnails-milan">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide"><img loading="lazy" alt="Mil√°n - Thumbnail 1" src="nuevosmodeloscontra/1.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Mil√°n - Thumbnail 2" src="nuevosmodeloscontra/2.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Mil√°n - Thumbnail 3" src="nuevosmodeloscontra/3.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Mil√°n - Thumbnail 4" src="nuevosmodeloscontra/4.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Mil√°n - Thumbnail 5" src="nuevosmodeloscontra/5.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Mil√°n - Thumbnail 6" src="nuevosmodeloscontra/6.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Mil√°n - Thumbnail 7" src="nuevosmodeloscontra/7.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Mil√°n - Thumbnail 8" src="nuevosmodeloscontra/8.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Mil√°n - Thumbnail 9" src="nuevosmodeloscontra/9.webp"></div>
                            </div>
                        </div>
                        <div class="product-selection" id="talles-milan">
                            <div class="product-info-details">
                                <div class="product-specs">
                                    <span class="spec-item"><strong>Material:</strong> Cuero y hebillas met√°licas</span>
                                    <span class="spec-item"><strong>Suela:</strong> Expanso</span>
                                    <span class="spec-item shipping-free"><strong>Env√≠o:</strong> GRATIS üöö</span>
                                </div>
                                <div class="product-badges-new">
                                    <span class="badge badge-bestseller">NUEVA TEMPORADA</span>
                                    <span class="badge badge-limited">STOCK LIMITADO</span>
                                </div>                                <p class="product-description">¬°Renovate para la nueva temporada Primavera-Verano 2025! Nuestro modelo Mil√°n es el complemento ideal para cualquier look. Su dise√±o vers√°til y ultra c√≥modo te va a encantar.</p>

                                <div class="size-guide-container">
                                    <div class="size-guide-toggle">
                                        <h3>GU√çA DE TALLES</h3>
                                        <span class="toggle-icon">+</span>
                                    </div>
                                    <div class="size-guide-content">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>TALLE</th>
                                                    <th>CENT√çMETROS</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr><td>35</td><td>23 cm</td></tr>
                                                <tr><td>36</td><td>23,2 cm</td></tr>
                                                <tr><td>37</td><td>24 cm</td></tr>
                                                <tr><td>38</td><td>25 cm</td></tr>
                                                <tr><td>39</td><td>25,5 cm</td></tr>
                                                <tr><td>40</td><td>26 cm</td></tr>
                                            </tbody>
                                        </table>
                                        <div class="size-instructions">
                                            <h4>¬øC√ìMO MEDIR?</h4>
                                            <ol>
                                                <li>Eleg√≠ una plantilla de un calzado que utilices habitualmente.</li>
                                                <li>Tom√° la medida por el centro del largo de la plantilla (no la base).</li>
                                                <li>Eleg√≠ tu talle acorde al n√∫mero que te dio la plantilla.</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                                <div class="product-price-quantity">
                                    <div class="promo-explanation">
                                        <p class="promo-note">* 2 pares por $85.000 (cualquier combinaci√≥n)</p>
                                    </div>
                                    <div class="quantity-price-selector">
                                        <label class="quantity-price-option">
                                            <input checked="checked" name="hwA-qty-milan" type="radio" value="1" />
                                            <div class="option-content">
                                                <div class="option-quantity">1 par</div>
                                                <div class="option-price">$55.000</div>
                                            </div>
                                        </label>
                                        <label class="quantity-price-option">
                                            <input name="hwA-qty-milan" type="radio" value="2" />
                                            <div class="option-content">
                                                <div class="option-quantity">2 pares <span class="promo-tag">OFERTA</span></div>
                                                <div class="option-price">$85.000</div>
                                                <div class="option-save">($42.500 c/par - ¬°AHORR√ÅS $35.000!)</div>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="size-selector">
                                    <fieldset id="hwA-milan-1">
                                        <div class="form-group">
                                            <label for="talle-select-milan-1" class="sr-only">Talle Par 1</label>
                                            <select id="talle-select-milan-1" class="form-control talle">
                                                <option value="">-- Selecciona Talle Par 1 --</option>
                                                <option value="35-milan">35 (23 cm)</option>
                                                <option value="36-milan">36 (23,2 cm)</option>
                                                <option value="37-milan">37 (24 cm)</option>
                                                <option value="38-milan">38 (25 cm)</option>
                                                <option value="39-milan">39 (25,5 cm)</option>
                                                <option value="40-milan">40 (26 cm)</option>
                                            </select>
                                        </div>
                                        <button type="button" class="add-to-cart-btn" data-model="milan-1">üõí Agregar al carrito</button>
                                    </fieldset>
                                    <fieldset class="fieldsetstalles" id="hwA-milan-2">
                                        <div class="form-group">
                                            <label for="talle-select-milan-2" class="sr-only">Talle Par 2</label>
                                            <select id="talle-select-milan-2" class="form-control talle">
                                                <option value="">-- Selecciona Talle Par 2 --</option>
                                                <option value="35-milan">35 (23 cm)</option>
                                                <option value="36-milan">36 (23,2 cm)</option>
                                                <option value="37-milan">37 (24 cm)</option>
                                                <option value="38-milan">38 (25 cm)</option>
                                                <option value="39-milan">39 (25,5 cm)</option>
                                                <option value="40-milan">40 (26 cm)</option>
                                            </select>
                                        </div>
                                        <button type="button" class="add-to-cart-btn" data-model="milan-2">üõí Agregar al carrito</button>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- PRODUCTO: Trento -->
                    <div class="product-item" id="modeload-trento">

                        <h2>Trento</h2>
                        <div class="swiper" id="swiper-trento">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide"><img alt="Trento - Vista 1" src="nuevosmodeloscontra/10.webp" fetchpriority="high" decoding="async"></div>
                                <div class="swiper-slide"><img alt="Trento - Vista 2" src="nuevosmodeloscontra/11.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Trento - Vista 3" src="nuevosmodeloscontra/12.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Trento - Vista 4" src="nuevosmodeloscontra/13.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Trento - Vista 5" src="nuevosmodeloscontra/14.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Trento - Vista 6" src="nuevosmodeloscontra/15.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Trento - Vista 7" src="nuevosmodeloscontra/16.webp" loading="lazy"></div>
                            </div>
                            <div class="swiper-button-prev"></div>
                            <div class="swiper-button-next"></div>
                        </div>
                        <div class="swiper-container" id="swiper-thumbnails-trento">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide"><img loading="lazy" alt="Trento - Thumbnail 1" src="nuevosmodeloscontra/10.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Trento - Thumbnail 2" src="nuevosmodeloscontra/11.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Trento - Thumbnail 3" src="nuevosmodeloscontra/12.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Trento - Thumbnail 4" src="nuevosmodeloscontra/13.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Trento - Thumbnail 5" src="nuevosmodeloscontra/14.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Trento - Thumbnail 6" src="nuevosmodeloscontra/15.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Trento - Thumbnail 7" src="nuevosmodeloscontra/16.webp"></div>
                            </div>
                        </div>
                        <div class="product-selection" id="talles-trento">
                            <div class="product-info-details">
                                <div class="product-specs">
                                    <span class="spec-item"><strong>Material:</strong> Cuero y hebillas met√°licas</span>
                                    <span class="spec-item"><strong>Suela:</strong> Expanso</span>
                                    <span class="spec-item shipping-free"><strong>Env√≠o:</strong> GRATIS üöö</span>
                                </div>
                                <div class="product-badges-new">
                                    <span class="badge badge-bestseller">NUEVA TEMPORADA</span>
                                    <span class="badge badge-limited">STOCK LIMITADO</span>
                                </div>
                                <p class="product-description">¬°Renovate para la nueva temporada Primavera-Verano 2025! Nuestro modelo Trento es el complemento ideal para cualquier look. Su dise√±o vers√°til y ultra c√≥modo te va a encantar.</p>

                                <div class="size-guide-container">
                                    <div class="size-guide-toggle">
                                        <h3>GU√çA DE TALLES</h3>
                                        <span class="toggle-icon">+</span>
                                    </div>
                                    <div class="size-guide-content">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>TALLE</th>
                                                    <th>CENT√çMETROS</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr><td>35</td><td>23 cm</td></tr>
                                                <tr><td>36</td><td>23,2 cm</td></tr>
                                                <tr><td>37</td><td>24 cm</td></tr>
                                                <tr><td>38</td><td>25 cm</td></tr>
                                                <tr><td>39</td><td>25,5 cm</td></tr>
                                                <tr><td>40</td><td>26 cm</td></tr>
                                            </tbody>
                                        </table>
                                        <div class="size-instructions">
                                            <h4>¬øC√ìMO MEDIR?</h4>
                                            <ol>
                                                <li>Eleg√≠ una plantilla de un calzado que utilices habitualmente.</li>
                                                <li>Tom√° la medida por el centro del largo de la plantilla (no la base).</li>
                                                <li>Eleg√≠ tu talle acorde al n√∫mero que te dio la plantilla.</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                                <div class="product-price-quantity">
                                    <div class="promo-explanation">
                                        <p class="promo-note">* 2 pares por $85.000 (cualquier combinaci√≥n)</p>
                                    </div>
                                    <div class="quantity-price-selector">
                                        <label class="quantity-price-option">
                                            <input checked="checked" name="hwA-qty-trento" type="radio" value="1" />
                                            <div class="option-content">
                                                <div class="option-quantity">1 par</div>
                                                <div class="option-price">$55.000</div>
                                            </div>
                                        </label>
                                        <label class="quantity-price-option">
                                            <input name="hwA-qty-trento" type="radio" value="2" />
                                            <div class="option-content">
                                                <div class="option-quantity">2 pares <span class="promo-tag">OFERTA</span></div>
                                                <div class="option-price">$85.000</div>
                                                <div class="option-save">($42.500 c/par - ¬°AHORR√ÅS $35.000!)</div>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="size-selector">
                                    <fieldset id="hwA-trento-1">
                                        <div class="form-group">
                                            <label for="talle-select-trento-1" class="sr-only">Talle Par 1</label>
                                            <select id="talle-select-trento-1" class="form-control talle">
                                                <option value="">-- Selecciona Talle Par 1 --</option>
                                                <option value="35-trento">35 (23 cm)</option>
                                                <option value="36-trento">36 (23,2 cm)</option>
                                                <option value="37-trento">37 (24 cm)</option>
                                                <option value="38-trento">38 (25 cm)</option>
                                                <option value="39-trento">39 (25,5 cm)</option>
                                                <option value="40-trento">40 (26 cm)</option>
                                            </select>
                                        </div>
                                        <button type="button" class="add-to-cart-btn" data-model="trento-1">üõí Agregar al carrito</button>
                                    </fieldset>
                                    <fieldset class="fieldsetstalles" id="hwA-trento-2">
                                        <div class="form-group">
                                            <label for="talle-select-trento-2" class="sr-only">Talle Par 2</label>
                                            <select id="talle-select-trento-2" class="form-control talle">
                                                <option value="">-- Selecciona Talle Par 2 --</option>
                                                <option value="35-trento">35 (23 cm)</option>
                                                <option value="36-trento">36 (23,2 cm)</option>
                                                <option value="37-trento">37 (24 cm)</option>
                                                <option value="38-trento">38 (25 cm)</option>
                                                <option value="39-trento">39 (25,5 cm)</option>
                                                <option value="40-trento">40 (26 cm)</option>
                                            </select>
                                        </div>
                                        <button type="button" class="add-to-cart-btn" data-model="trento-2">üõí Agregar al carrito</button>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- PRODUCTO: Parma -->
                    <div class="product-item" id="modeload-parma">

                        <h2>Parma</h2>
                        <div class="swiper" id="swiper-parma">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide"><img alt="Parma - Vista 1" src="nuevosmodeloscontra/17.webp" fetchpriority="high" decoding="async"></div>
                                <div class="swiper-slide"><img alt="Parma - Vista 2" src="nuevosmodeloscontra/18.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Parma - Vista 3" src="nuevosmodeloscontra/19.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Parma - Vista 4" src="nuevosmodeloscontra/20.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Parma - Vista 5" src="nuevosmodeloscontra/21.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Parma - Vista 6" src="nuevosmodeloscontra/22.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Parma - Vista 7" src="nuevosmodeloscontra/23.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Parma - Vista 8" src="nuevosmodeloscontra/24.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Parma - Vista 9" src="nuevosmodeloscontra/25.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Parma - Vista 10" src="nuevosmodeloscontra/26.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Parma - Vista 11" src="nuevosmodeloscontra/27.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Parma - Vista 12" src="nuevosmodeloscontra/28.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Parma - Vista 13" src="nuevosmodeloscontra/29.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Parma - Vista 14" src="nuevosmodeloscontra/30.webp" loading="lazy"></div>
                                <div class="swiper-slide"><img alt="Parma - Vista 15" src="nuevosmodeloscontra/31.webp" loading="lazy"></div>
                            </div>
                            <div class="swiper-button-prev"></div>
                            <div class="swiper-button-next"></div>
                        </div>
                        <div class="swiper" id="swiper-thumbnails-parma">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide"><img loading="lazy" alt="Parma - Thumbnail 1" src="nuevosmodeloscontra/17.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Parma - Thumbnail 2" src="nuevosmodeloscontra/18.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Parma - Thumbnail 3" src="nuevosmodeloscontra/19.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Parma - Thumbnail 4" src="nuevosmodeloscontra/20.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Parma - Thumbnail 5" src="nuevosmodeloscontra/21.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Parma - Thumbnail 6" src="nuevosmodeloscontra/22.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Parma - Thumbnail 7" src="nuevosmodeloscontra/23.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Parma - Thumbnail 8" src="nuevosmodeloscontra/24.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Parma - Thumbnail 9" src="nuevosmodeloscontra/25.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Parma - Thumbnail 10" src="nuevosmodeloscontra/26.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Parma - Thumbnail 11" src="nuevosmodeloscontra/27.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Parma - Thumbnail 12" src="nuevosmodeloscontra/28.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Parma - Thumbnail 13" src="nuevosmodeloscontra/29.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Parma - Thumbnail 14" src="nuevosmodeloscontra/30.webp"></div>
                                <div class="swiper-slide"><img loading="lazy" alt="Parma - Thumbnail 15" src="nuevosmodeloscontra/31.webp"></div>
                            </div>
                        </div>
                        <div class="product-selection" id="talles-parma">
                            <div class="product-info-details">
                                <div class="product-specs">
                                    <span class="spec-item"><strong>Material:</strong> Gamuza</span>
                                    <span class="spec-item"><strong>Suela:</strong> Expanso</span>
                                    <span class="spec-item shipping-free"><strong>Env√≠o:</strong> GRATIS üöö</span>
                                </div>
                                <div class="product-badges-new">
                                    <span class="badge badge-bestseller">NUEVA TEMPORADA</span>
                                    <span class="badge badge-limited">STOCK LIMITADO</span>
                                </div>
                                <p class="product-description">¬°Renovate para la nueva temporada Primavera-Verano 2025! Nuestro modelo Parma es el complemento ideal para cualquier look. Su dise√±o vers√°til y ultra c√≥modo te va a encantar.</p>

                                <div class="size-guide-container">
                                    <div class="size-guide-toggle">
                                        <h3>GU√çA DE TALLES</h3>
                                        <span class="toggle-icon">+</span>
                                    </div>
                                    <div class="size-guide-content">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>TALLE</th>
                                                    <th>CENT√çMETROS</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr><td>35</td><td>23 cm</td></tr>
                                                <tr><td>36</td><td>23,2 cm</td></tr>
                                                <tr><td>37</td><td>24 cm</td></tr>
                                                <tr><td>38</td><td>25 cm</td></tr>
                                                <tr><td>39</td><td>25,5 cm</td></tr>
                                                <tr><td>40</td><td>26 cm</td></tr>
                                            </tbody>
                                        </table>
                                        <div class="size-instructions">
                                            <h4>¬øC√ìMO MEDIR?</h4>
                                            <ol>
                                                <li>Eleg√≠ una plantilla de un calzado que utilices habitualmente.</li>
                                                <li>Tom√° la medida por el centro del largo de la plantilla (no la base).</li>
                                                <li>Eleg√≠ tu talle acorde al n√∫mero que te dio la plantilla.</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                                <div class="product-price-quantity">
                                    <div class="promo-explanation">
                                        <p class="promo-note">* 2 pares por $85.000 (cualquier combinaci√≥n)</p>
                                    </div>
                                    <div class="quantity-price-selector">
                                        <label class="quantity-price-option">
                                            <input checked="checked" name="hwA-qty-parma" type="radio" value="1" />
                                            <div class="option-content">
                                                <div class="option-quantity">1 par</div>
                                                <div class="option-price">$55.000</div>
                                            </div>
                                        </label>
                                        <label class="quantity-price-option">
                                            <input name="hwA-qty-parma" type="radio" value="2" />
                                            <div class="option-content">
                                                <div class="option-quantity">2 pares <span class="promo-tag">OFERTA</span></div>
                                                <div class="option-price">$85.000</div>
                                                <div class="option-save">($42.500 c/par - ¬°AHORR√ÅS $35.000!)</div>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="size-selector">
                                    <fieldset id="hwA-parma-1">
                                        <div class="form-group">
                                            <label for="talle-select-parma-1" class="sr-only">Talle Par 1</label>
                                            <select id="talle-select-parma-1" class="form-control talle">
                                                <option value="">-- Selecciona Talle Par 1 --</option>
                                                <option value="35-parma">35 (23 cm)</option>
                                                <option value="36-parma">36 (23,2 cm)</option>
                                                <option value="37-parma">37 (24 cm)</option>
                                                <option value="38-parma">38 (25 cm)</option>
                                                <option value="39-parma">39 (25,5 cm)</option>
                                                <option value="40-parma">40 (26 cm)</option>
                                            </select>
                                        </div>
                                        <button type="button" class="add-to-cart-btn" data-model="parma-1">üõí Agregar al carrito</button>
                                    </fieldset>
                                    <fieldset class="fieldsetstalles" id="hwA-parma-2">
                                        <div class="form-group">
                                            <label for="talle-select-parma-2" class="sr-only">Talle Par 2</label>
                                            <select id="talle-select-parma-2" class="form-control talle">
                                                <option value="">-- Selecciona Talle Par 2 --</option>
                                                <option value="35-parma">35 (23 cm)</option>
                                                <option value="36-parma">36 (23,2 cm)</option>
                                                <option value="37-parma">37 (24 cm)</option>
                                                <option value="38-parma">38 (25 cm)</option>
                                                <option value="39-parma">39 (25,5 cm)</option>
                                                <option value="40-parma">40 (26 cm)</option>
                                            </select>
                                        </div>
                                        <button type="button" class="add-to-cart-btn" data-model="parma-2">üõí Agregar al carrito</button>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="checkout-navigation product-nav-bottom">
                    <div class="shopping-instructions">
                        <p><span class="instruction-icon">üëç</span> ¬°Selecciona tus productos favoritos y agr√©galos al carrito!</p>
                    </div>

                </div>
            </fieldset>

            <!-- Testimonials Section -->
            <section class="testimonials-section">
                <h2 class="text-center">Lo que dicen nuestras clientas</h2>
                <p class="testimonials-subtitle">Miles de clientas felices comparten su experiencia</p>

                <!-- Testimonials Grid -->
                <div class="testimonials-grid" id="testimonials-grid">
                    <!-- Los comentarios se cargar√°n din√°micamente aqu√≠ -->
                </div>

                <!-- "Ver m√°s" Link -->
                <div class="testimonials-more" id="testimonials-more" style="text-align: center; margin-top: 20px;">
                    <a href="#" id="load-more-testimonials" style="color: #a05941; text-decoration: none; font-style: italic;">Ver m√°s comentarios...</a>
                </div>

                <!-- Loading indicator (ahora oculto por defecto) -->
                <div class="testimonials-loading" id="testimonials-loading" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>Cargando m√°s comentarios...</p>
                </div>

                <!-- Back to products button (shown when cart is empty) -->
                <div class="back-to-products" id="back-to-products" style="display: none;">
                    <button type="button" class="btn-back-to-products" onclick="scrollToProducts()">
                        ‚¨ÜÔ∏è Ver nuestros productos
                    </button>
                    <p class="back-to-products-text">¬øTe gustaron los comentarios? ¬°Descubre nuestros modelos!</p>
                </div>
            </section>

            <!-- Shipping and Payment Form Section -->
            <div id="restodelform" class="checkout-section hidden">
                <h2 id="datos-envio">¬°Casi listos! Completa tus datos</h2>
                <div class="checkout-steps">
                    <div class="checkout-step active" id="shipping-step">
                        <span class="step-number">1</span>
                        <span class="step-name">Informaci√≥n de Env√≠o</span>
                    </div>
                    <div class="checkout-step" id="payment-step">
                        <span class="step-number">2</span>
                        <span class="step-name">M√©todo de Pago</span>
                    </div>
                    <div class="checkout-step" id="review-step">
                        <span class="step-number">3</span>
                        <span class="step-name">Revisar y Confirmar</span>
                    </div>
                </div>

                <fieldset>
                    <legend>Resumen de tu Pedido</legend>
                    <div class="form-group">
                        <label for="286442883">Modelos y Talles Seleccionados:</label>
                        <input class="form-control" id="286442883" name="entry.286442883" readonly="readonly" type="text" placeholder="Aqu√≠ ver√°s tu selecci√≥n..." />
                        <p class="help-block">Confirma que sean los correctos antes de seguir.</p>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Informaci√≥n de Contacto</legend>
                    <div class="form-group" style="display:none;">
                        <label for="1214200077">Email</label>
                        <input class="form-control" id="1214200077" name="entry.1214200077" placeholder="tuemail@ejemplo.com" type="email" />
                        <p class="help-block">Para enviarte la confirmaci√≥n y el seguimiento de tu pedido.</p>
                    </div>
                    <div class="form-group">
                        <label for="1211347450">Nombre y Apellido <span style="color:red">*</span></label>
                        <input class="form-control" id="1211347450" name="entry.1211347450" placeholder="Quien recibe el pedido" required type="text" />
                    </div>
                    <div class="form-group">
                        <label for="501094818">WhatsApp <span style="color:red">*</span></label>
                        <input class="form-control" id="501094818" name="entry.501094818" placeholder="Ej: 1156457057 (sin 0 ni 15)" required type="tel" onblur="validateWhatsAppInline()" />
                        <!-- Error message element -->
                        <div class="error-message" data-target="501094818"></div>
                        <p class="help-block">Fundamental para coordinar el env√≠o si es necesario.</p>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Direcci√≥n de Env√≠o <span style="color:red">*</span></legend>
                    <p class="help-block" style="margin-bottom: 20px;">¬°Aseg√∫rate que sea correcta para recibir tu paquete sin problemas!</p>
                    <div class="form-group">
                        <label for="394819614">Calle y N√∫mero (Piso/Dpto)</label>
                        <input class="form-control" id="394819614" name="entry.394819614" placeholder="Ej: Av. Siempreviva 742, 3B" required type="text"/>
                    </div>
                    <div class="form-group">
                        <label for="entre-calles">Entre Calles (obligatorio)</label>
                        <input class="form-control" id="entre-calles" name="temp_entre_calles" placeholder="Ej: Entre Av. Corrientes y Lavalle" required type="text"/>
                        <small class="form-text text-muted">Se agregar√° autom√°ticamente al campo anterior</small>
                    </div>
                    <div class="form-group">
                        <label for="183290493">C√≥digo Postal</label>
                        <input class="form-control" id="183290493" name="entry.183290493" placeholder="Ej: 1425" required type="text" />
                    </div>
                    <div class="form-group">
                        <label for="2081271241">Localidad</label>
                        <input class="form-control" id="2081271241" name="entry.2081271241" placeholder="Ej: Palermo" required type="text" />
                    </div>
                    <div class="form-group">
                        <label for="1440375758">Provincia</label>
                        <select class="form-control" id="1440375758" name="entry.1440375758" required title="Provincia">
                            <option value="">-- Selecciona tu Provincia --</option>
                            <option value="Capital Federal">CABA</option>
                            <option value="Gran Buenos Aires">Gran Buenos Aires</option>
                            <option value="Buenos Aires">Buenos Aires</option>
                        </select>
                        <p class="help-block"><strong>Solo enviamos a Ciudad de Buenos Aires y Gran Buenos Aires.</strong></p>
                    </div>

                    <!-- Hidden field for shipping method -->
                    <div class="form-group hidden">
                        <select class="form-control" id="2315500325" name="entry.17650825"><option selected value="A DOMICILIO">A DOMICILIO</option></select>
                    </div>
                </fieldset>

                <fieldset id="payment-section">
                    <legend>ENV√çO: selecciona uno de los d√≠as presentados en las opciones para recibir y asegurate que si vos no est√°s haya alguien para recibir y abonar la compra en el horario de 15hs a 22hs.<br><br> El pago es <u>s√≥lo en efectivo</u> y debes contar con todo el dinero. Vamos a contactarte por Whatsapp para confirmar el env√≠o y debes respondernos para confirmarlo o no se env√≠a.</legend>
                    <p><a href="#" class="instructions-link"><i class="fas fa-info-circle"></i> ¬øC√≥mo funciona el contrareembolso?</a></p>
                    <input type="hidden" id="comoabona" name="entry.comoabona" value="contrareembolso">
                </fieldset>

                <fieldset>
                    <legend>D√≠a y Hora estimada para entregar</legend>
                    <div class="form-group">
                        <select class="form-control" id="1756027935" name="entry.1756027935" required="" type="text" title="diayhora">
                            <!-- Las opciones se cargar√°n din√°micamente con JavaScript -->
                        </select>
                        <p class="help-block">Aseg√∫rate que si t√∫ no est√°s, haya alguien para recibir y abonar la compra en el horario de 15hs a 22hs.</p>
                    </div>
                </fieldset>

                <div id="confirma-pedido" class="review-section">
                    <h3>Revisa tu Pedido y Datos</h3>
                    <p><strong>Selecci√≥n:</strong> <span id="help-modelostallesseleccionados">-</span></p>
                    <p><strong>Nombre:</strong> <span id="help-nombre">-</span></p>
                    <p><strong>WhatsApp:</strong> <span id="help-wapp">-</span></p>
                    <p><strong>Direcci√≥n:</strong> <span id="help-calleyaltura">-</span>, <span id="help-localidad">-</span> (<span id="help-cp">-</span>), <span id="help-provincia">-</span></p>

                    <p><strong>D√≠a y Hora de Entrega:</strong> <span id="help-diayhora">-</span></p>

                    <p id="preciototal">Elige modelos y talles para ver el total</p>

                    <p style="font-size:14px;"><span style="background-color:#FFFF00;">PAG√ÅS <u>S√ìLO EN EFECTIVO AL RECIBIR</u>. SI NO DISPONES DE LA TOTALIDAD DEL EFECTIVO NO HAGAS EL PEDIDO. TU PEDIDO ES UN COMPROMISO DE PAGO.</span></p>

                    <p class="help-block">
                        ‚úì RECIBE EN: <span class="entregamasrapida"></span>. Te contactaremos para confirmar.<br>
                        ‚úì Aseg√∫rate de tener el efectivo listo para pagar al delivery.
                    </p>
                </div>

                <p class="help-block text-center" style="font-size: 0.9em; margin-top: 20px;">¬°Recuerda! Env√≠o GRATIS a todo el pa√≠s. Pagas en efectivo al recibir.</p>
                <div class="checkout-navigation">
                    <a href="#" class="text-link" id="back-to-products">‚Üê Volver a productos</a>
                    <input class="btn btn-primary" id="botoncomprar" type="submit" value="COMPRAR üõí" />
                </div>
            </div>
        </form>
        <!-- Form End -->

    </div> <!-- End Container -->

    <!-- Notification Area -->
    <div id="notification-container"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay">
        <div class="loading-spinner"></div>
        <p class="loading-message">Procesando tu pedido de contrarreembolso...<br>Te redirigiremos a la confirmaci√≥n en unos segundos.<br><strong>No cierres ni actualices esta p√°gina.</strong></p>
    </div>

    <!-- Scripts cargados al final del documento para asegurar que jQuery est√© disponible -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.3.0/jquery.form.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/es.min.js"></script>

    <!-- Custom scripts -->
    <script src="carrusel-nuevos.js"></script>
    <script src="otono-elegante2.js?v=1.1"></script>
    <script src="form-handler-contrareembolso.js"></script>
<!-- <script src="fix-contrareembolso-cart.js?v=1.1"></script> -->
<script src="fix-precios-contrareembolso.js"></script>

    <!-- Chat Widget Script -->
    <script src="chat-widget-contrareembolso.js"></script>

    <!-- Countdown script -->
    <script>
        // Inicializar cuenta regresiva para cada producto
        document.addEventListener('DOMContentLoaded', function() {
            // Establecer la fecha de fin (48 horas desde ahora)
            const countdownElements = document.querySelectorAll('.countdown');

            // Actualizar cada segundo
            setInterval(function() {
                countdownElements.forEach(function(element) {
                    // Obtener valores actuales
                    const timeString = element.textContent;
                    const timeParts = timeString.split(':');
                    let hours = parseInt(timeParts[0]);
                    let minutes = parseInt(timeParts[1]);
                    let seconds = parseInt(timeParts[2]);

                    // Restar un segundo
                    seconds--;
                    if (seconds < 0) {
                        seconds = 59;
                        minutes--;
                        if (minutes < 0) {
                            minutes = 59;
                            hours--;
                            if (hours < 0) {
                                // Reiniciar a 48 horas cuando llegue a cero
                                hours = 48;
                                minutes = 0;
                                seconds = 0;
                            }
                        }
                    }

                    // Formatear y actualizar
                    element.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                });
            }, 1000);
        });
    </script>

    <!-- Script para el selector de fecha de env√≠o -->
    <script>
    $(document).ready(function() {
        // Asegurarse de que el selector de d√≠a y hora est√© vac√≠o antes de agregar opciones
        $("#1756027935").empty();
        // Obtener el d√≠a actual y la hora actual
        var today = moment();
        var currentTime = moment().format("HH:mm");

        // Obtener el d√≠a de la semana actual en formato num√©rico
        var todayNum = today.isoWeekday();

        // Definir las fechas disponibles seg√∫n el d√≠a y la hora actual
        var availableDates = [];

        if (todayNum == 1) { // Lunes
          // Jueves de esta semana y Martes de la pr√≥xima semana (m√≠nimo 24hs)
          availableDates.push(today.clone().add(3, "days")); // Jueves
          availableDates.push(today.clone().add(1, "weeks").isoWeekday(2)); // Martes siguiente
        } else if (todayNum == 2) { // Martes
          // Jueves de esta semana y Martes de la pr√≥xima semana
          availableDates.push(today.clone().add(2, "days")); // Jueves
          availableDates.push(today.clone().add(1, "weeks").isoWeekday(2)); // Martes siguiente
        } else if (todayNum == 3) { // Mi√©rcoles
          // Martes de la pr√≥xima semana y Jueves de la pr√≥xima semana (m√≠nimo 24hs)
          availableDates.push(today.clone().add(1, "weeks").isoWeekday(4)); // Jueves siguiente (primero porque es m√°s cercana)
          availableDates.push(today.clone().add(1, "weeks").isoWeekday(2)); // Martes siguiente
        } else if (todayNum == 4) { // Jueves
          // Martes de la pr√≥xima semana y Jueves de la pr√≥xima semana
          availableDates.push(today.clone().add(1, "weeks").isoWeekday(2)); // Martes siguiente (m√°s cercano)
          availableDates.push(today.clone().add(1, "weeks").isoWeekday(4)); // Jueves siguiente
        } else if (todayNum == 5) { // Viernes
          // Martes de la pr√≥xima semana y Jueves de la pr√≥xima semana
          availableDates.push(today.clone().add(1, "weeks").isoWeekday(2)); // Martes siguiente (m√°s cercano)
          availableDates.push(today.clone().add(1, "weeks").isoWeekday(4)); // Jueves siguiente
        } else if (todayNum == 6) { // S√°bado
          // Martes de la pr√≥xima semana y Jueves de la pr√≥xima semana
          availableDates.push(today.clone().add(1, "weeks").isoWeekday(2)); // Martes siguiente (m√°s cercano)
          availableDates.push(today.clone().add(1, "weeks").isoWeekday(4)); // Jueves siguiente
       } else { // Domingo (todayNum == 7)
  const currentHour = today.hour();
  const currentMinute = today.minute();

  const isBefore12_01 = currentHour < 12 || (currentHour === 12 && currentMinute === 0);

  if (isBefore12_01) {
    // Antes de las 12:01 ‚Üí Martes y Jueves de esta semana (Jueves es m√°s cercano)
    availableDates.push(today.clone().add(2, "days")); // Martes (m√°s cercano)
    availableDates.push(today.clone().add(4, "days")); // Jueves
  } else {
    // Desde las 12:01 ‚Üí Jueves de esta semana y Martes de la pr√≥xima
    availableDates.push(today.clone().add(4, "days")); // Jueves (m√°s cercano)
    availableDates.push(today.clone().add(1, "weeks").isoWeekday(2)); // Martes siguiente
  }
}

// ORDENAR FECHAS DE M√ÅS RECIENTE A M√ÅS ANTIGUA
availableDates.sort(function(a, b) {
    return a.diff(b);
});


        // Agregar las opciones al selector de fechas
        $.each(availableDates, function(index, value) {
          // Formatear el d√≠a con la primera letra en may√∫scula
          var dayName = value.format("dddd");
          dayName = dayName.charAt(0).toUpperCase() + dayName.slice(1);
          var monthName = value.format("MMMM");
          var dayNumber = value.format("D");

          var optionText = dayName + " " + dayNumber + " de " + monthName + " de 15hs a 22hs";
          var option = $("<option></option>").attr("value", optionText).text(optionText);
          // Seleccionar autom√°ticamente la primera opci√≥n
          if (index === 0) {
            option.attr("selected", "selected");
          }
          $("#1756027935").append(option);
        });

        // establecer el estilo uppercase para las opciones
        $('#1756027935 option').css('text-transform', 'uppercase');

        // Obtener el primer valor del select (que ahora est√° seleccionado)
        var primerValor = $('#1756027935 option:selected').val();

        // Asignar el primer valor al elemento #entregamasrapida
        $('.entregamasrapida').text(primerValor).css({ 'text-transform': 'uppercase', 'font-size': '12px'});

        // Actualizar el campo de resumen con el valor seleccionado
        $("#help-diayhora").html(primerValor);

        // Disparar el evento change para asegurar que se actualice el resumen
        $("#1756027935").trigger('change');
    });
    </script>

    <!-- Script para manejar los precios y el env√≠o del formulario -->
    <script>
    $(document).ready(function() {
      // Guardar la URL actual en el campo oculto
      var fbclidpedido = window.location.href;
      $("#227154461").val(fbclidpedido);

      // Manejar cambios en los selectores de productos
      $('#286442883').change(function() {
        // Asegurarse de que el valor se obtenga correctamente
        var value = $('#286442883').val() || '';
        console.log('Valor actual del campo de productos:', value);

        var pairs = value.split(', '); // split the input by ", " (comma and space)

        // remove empty elements from the array
        pairs = pairs.filter(Boolean);
        console.log('Pares detectados:', pairs);

        // store the values in an array
        var values = [];
        var montoacobrar;
        var costodepares = 0;
        for (var i = 0; i < pairs.length; i++) {
          var parts = pairs[i].split('-');
          if (parts.length < 2) {
            // the input is not properly formatted, skip this pair
            continue;
          }
          var talle = parts[0].trim(); // remove leading and trailing spaces from the size value
          var modelo = parts[1];
          var color = parts.slice(2).join(' '); // use all the words as the color

          var modeloId;
          var costo;
          switch(modelo) {
            case 'milan':
              modeloId = '#MILAN';
              costo = 3700;
              break;
            case 'trento':
              modeloId = '#TRENTO';
              costo = 3700;
              break;
            case 'parma':
              modeloId = '#PARMA';
              costo = 3700;
              break;
            default:
              modeloId = 'desconocido';
              costo = 0;
              break;
          }
          costodepares += costo;
          var modelosangies = 'Talle: ' + talle + ' Modelo: ' + modeloId + ' Color: ' + color;
          values.push(modelosangies);
        }

        // join the array elements with the desired separator
        var output = values.join(' || '); // use " || " as the separator between pairs

        // calcular monto a cobrar para contrareembolso
        if (pairs.length == 0) {
          montoacobrar = 0;
        } else if (pairs.length == 1) {
          montoacobrar = 55000; // Precio para 1 par en contrareembolso
        } else if (pairs.length == 2) {
          montoacobrar = 85000; // Precio para 2 pares en contrareembolso ($42.500 c/u)
        } else {
          montoacobrar = 0;
        }
        
        // Actualizar el precio total visible en el resumen
        if (pairs.length > 0) {
          var precioTotal = (pairs.length === 1) ? "$55.000" : "$85.000";
          $("#preciototal").html("Precio Total: " + precioTotal);
        } else {
          $("#preciototal").html("Elige modelos y talles para ver el total");
        }

        // asignar valores a los inputs
        $('#1885018612').val(output);
        $('#1715320252').val(montoacobrar);
        $('#736134777').val(costodepares);

        console.log('Campos ocultos actualizados:');
        console.log('1885018612 (detalles):', output);
        console.log('1715320252 (monto):', montoacobrar);
        console.log('736134777 (costo):', costodepares);
        console.log('286442883 (productos):', value);
      });

      // Verificar peri√≥dicamente si hay productos en el carrito
      setInterval(function() {
        var summaryContent = $('#286442883').val() || "";
        if (summaryContent) {
          console.log('Productos en el carrito detectados:', summaryContent);
        }
      }, 2000);
    });
    </script>

    <!-- Script para manejar el env√≠o del formulario eliminado para evitar doble posteo -->
    <!-- El env√≠o del formulario ahora se maneja exclusivamente en form-handler.js -->

    <!-- Script para manejar el caso en que el spinner se quede girando -->
    <script>
    $(document).ready(function() {
      // Establecer un temporizador para verificar si el spinner se queda girando
      $('#bootstrapForm').on('submit', function() {
        // Despu√©s de 15 segundos, verificar si el spinner sigue visible
        setTimeout(function() {
          if ($('.loading-overlay').hasClass('visible')) {
            console.log('El spinner sigue visible despu√©s de 15 segundos, intentando redireccionar manualmente');

            // Obtener los productos seleccionados
            var selectedProducts = $('#286442883').val();
            if (selectedProducts) {
              var pairs = selectedProducts.split(', ').filter(Boolean);

                          // Procesar los detalles del pedido para localStorage
                          var values = [];
                          var montoacobrar;
                          var costodepares = 0;
              
                          for (var i = 0; i < pairs.length; i++) {
                            var parts = pairs[i].split('-');
                            if (parts.length < 2) continue;
              
                            var talle = parts[0].trim();
                            var modelo = parts[1];
                            var color = parts.slice(2).join(' ');
              
                            var modeloId;
                            var costo;
                            switch(modelo) {
                              case 'milan':
                                modeloId = '#MILAN';
                                costo = 3700;
                                break;
                              case 'trento':
                                modeloId = '#TRENTO';
                                costo = 3700;
                                break;
                              case 'parma':
                                modeloId = '#PARMA';
                                costo = 3700;
                                break;
                              default:
                                modeloId = 'desconocido';
                                costo = 0;
                                break;
                            }
                            costodepares += costo;
                            var modelosangies = 'Talle: ' + talle + ' Modelo: ' + modeloId + ' Color: ' + color;
                            values.push(modelosangies);
                          }
              // Guardar detalles en localStorage
              var output = values.join(' || ');
              localStorage.setItem('orderDetails', output);
              localStorage.setItem('rawProducts', selectedProducts);

              // Construir la URL de redirecci√≥n
              var redirectUrl;
              if (pairs.length === 1) {
                redirectUrl = 'gracias-1par-c.html?286442883=' + encodeURIComponent(selectedProducts);
              } else if (pairs.length === 2) {
                redirectUrl = 'gracias-2pares-c.html?286442883=' + encodeURIComponent(selectedProducts);
              } else {
                redirectUrl = 'gracias-3pares.html?286442883=' + encodeURIComponent(selectedProducts);
              }

              // Mostrar un mensaje al usuario
              if (confirm('Tu pedido ha sido enviado, pero parece que hay un problema con la redirecci√≥n. ¬øQuieres ir a la p√°gina de confirmaci√≥n?')) {
                // Ocultar el spinner
                $('.loading-overlay').removeClass('visible');

                // Redireccionar
                window.location.href = redirectUrl;
              } else {
                // Si el usuario cancela, ocultar el spinner
                $('.loading-overlay').removeClass('visible');
                $('#botoncomprar').val('COMPRAR üõí').prop('disabled', false);
              }
            } else {
              // Si no hay productos seleccionados, simplemente ocultar el spinner
              $('.loading-overlay').removeClass('visible');
              $('#botoncomprar').val('COMPRAR üõí').prop('disabled', false);
            }
          }
        }, 15000);
      });
    });
    </script>

    <!-- Script para actualizar los campos de ayuda en la secci√≥n de revisi√≥n del pedido -->
    <script>
    $(document).ready(function() {
      // Funci√≥n para actualizar todos los campos de ayuda
      function updateAllHelpFields() {
        $("#help-modelostallesseleccionados").html($("#286442883").val());
        $("#help-nombre").html($("#1211347450").val());
        $("#help-wapp").html($("#501094818").val());
        $("#help-calleyaltura").html($("#394819614").val());
        $("#help-localidad").html($("#2081271241").val());
        $("#help-provincia").html($("#1440375758").val());
        $("#help-cp").html($("#183290493").val());
        $("#help-diayhora").html($("#1756027935").val());
      }

      // Actualizar los campos de ayuda cuando cambian los valores de los campos
      $("#286442883, #1211347450, #501094818, #394819614, #2081271241, #1440375758, #183290493, #entre-calles").on('keyup change', function() {
        updateAllHelpFields();
      });

      // Funci√≥n para concatenar campos antes del env√≠o del formulario
      function concatenarCamposDireccion() {
        var calleAltura = $('#394819614').val() || '';
        var entreCalles = $('#entre-calles').val() || '';
        
        if (entreCalles.trim()) {
          if (calleAltura.trim()) {
            var valorConcatenado = calleAltura + ' - ' + entreCalles;
            $('#394819614').val(valorConcatenado);
          } else {
            $('#394819614').val(entreCalles);
          }
        }
      }

      // Ejecutar concatenaci√≥n justo antes del env√≠o del formulario
      $('#bootstrapForm').on('submit', function() {
        concatenarCamposDireccion();
      });

      // Verificar que el campo de direcci√≥n incluya entre calles
      $('#entre-calles').on('blur', function() {
        var entreCalles = $(this).val();
        if (!entreCalles.trim()) {
          console.log('Campo Entre Calles obligatorio');
        }
      });

      // Tambi√©n actualizar cuando cambia el selector de fecha
      $("#1756027935").change(function() {
        $("#help-diayhora").html($("#1756027935").val());
      });

      // Actualizar todos los campos al cargar la p√°gina
      setTimeout(function() {
        updateAllHelpFields();
      }, 500);
    });
    </script>

    <!-- Script para instrucciones de contrareembolso -->
    <script>
    $(document).ready(function() {
      // El enlace de instrucciones ya est√° incluido en el HTML

      // Script de depuraci√≥n para verificar que los productos se agreguen correctamente
      console.log("Inicializando script de depuraci√≥n para contrareembolso");

      // Agregar un manejador para el formulario que asegure la redirecci√≥n
      $('#bootstrapForm').on('submit', function() {
        // Guardar los productos seleccionados en localStorage para recuperarlos si hay problemas
        var selectedProducts = $('#286442883').val();
        if (selectedProducts) {
          localStorage.setItem('selectedProducts', selectedProducts);
          console.log('Productos guardados en localStorage:', selectedProducts);

          // Establecer un temporizador para verificar si la redirecci√≥n no ocurri√≥
          localStorage.setItem('formSubmitTime', Date.now());
        }
      });

      // Verificar si hubo un env√≠o previo que no redireccion√≥
      var lastSubmitTime = localStorage.getItem('formSubmitTime');
      if (lastSubmitTime) {
        var currentTime = Date.now();
        var timeDiff = currentTime - parseInt(lastSubmitTime);

        // Si han pasado m√°s de 10 segundos desde el √∫ltimo env√≠o, intentar redireccionar manualmente
        if (timeDiff > 10000) {
          console.log('Detectado env√≠o previo sin redirecci√≥n, intentando redireccionar manualmente');

          var savedProducts = localStorage.getItem('selectedProducts');
          if (savedProducts) {
            var pairs = savedProducts.split(', ').filter(Boolean);
            console.log('Productos recuperados:', pairs);

            // Procesar los detalles del pedido para localStorage si no existen ya
            if (!localStorage.getItem('orderDetails')) {
              var values = [];
              var montoacobrar;
              var costodepares = 0;

              for (var i = 0; i < pairs.length; i++) {
                var parts = pairs[i].split('-');
                if (parts.length < 2) continue;

                var talle = parts[0].trim();
                var modelo = parts[1];
                var color = parts.slice(2).join(' ');

                var modeloId;
                var costo;
                switch(modelo) {
                  case 'milan':
                    modeloId = '#MILAN';
                    costo = 3700;
                    break;
                  case 'trento':
                    modeloId = '#TRENTO';
                    costo = 3700;
                    break;
                  case 'parma':
                    modeloId = '#PARMA';
                    costo = 3700;
                    break;
                  default:
                    modeloId = 'desconocido';
                    break;
                }
                costodepares += costo;
                var modelosangies = 'Talle: ' + talle + ' Modelo: ' + modeloId + ' Color: ' + color;
                values.push(modelosangies);
              }

              // Guardar detalles en localStorage
              var output = values.join(' || ');
              localStorage.setItem('orderDetails', output);
              localStorage.setItem('rawProducts', savedProducts);
            }

            // Construir la URL de redirecci√≥n
            var redirectUrl;
            if (pairs.length === 1) {
              redirectUrl = 'gracias-1par-c.html?286442883=' + encodeURIComponent(savedProducts);
            } else if (pairs.length === 2) {
              redirectUrl = 'gracias-2pares-c.html?286442883=' + encodeURIComponent(savedProducts);
            } else {
              redirectUrl = 'gracias-3pares.html?286442883=' + encodeURIComponent(savedProducts);
            }

            // Mostrar un mensaje al usuario
            if (confirm('Parece que tu pedido fue enviado correctamente, pero hubo un problema con la redirecci√≥n. ¬øQuieres ir a la p√°gina de confirmaci√≥n?')) {
              // Limpiar el localStorage
              localStorage.removeItem('formSubmitTime');
              localStorage.removeItem('selectedProducts');

              // Redireccionar
              window.location.href = redirectUrl;
            } else {
              // Si el usuario cancela, limpiar solo el tiempo de env√≠o
              localStorage.removeItem('formSubmitTime');
            }
          }
        }
      }

      // Verificar el valor inicial del campo de productos
      console.log("Valor inicial del campo de productos:", $("#286442883").val());

      // Monitorear cambios en el campo de productos
      $("#286442883").on('change', function() {
        console.log("Campo de productos actualizado:", $(this).val());
      });

      // Monitorear clics en los botones de agregar al carrito
      $('.add-to-cart-btn').on('click', function() {
        var modelId = $(this).data('model');
        console.log("Bot√≥n de agregar al carrito clickeado:", modelId);

        // Verificar si se encuentra el selector de talle
        var $select;
        if (modelId.includes('-1') || modelId.includes('-2')) {
          // Si el ID incluye -1 o -2 (para el primer o segundo par)
          $select = $('#talle-select-' + modelId);
          if ($select.length === 0) {
            // Intentar encontrar el selector dentro del fieldset correspondiente
            var fieldsetId = 'hwA-' + modelId;
            $select = $('#' + fieldsetId + ' select.talle');
          }
        } else {
          // Fallback para buscar cualquier selector con ese modelo
          $select = $('select.talle[id*="' + modelId + '"]').first();
        }

        // Si a√∫n no encontramos el selector, buscar dentro del bot√≥n que se hizo clic
        if ($select.length === 0) {
          $select = $(this).closest('fieldset').find('select.talle');
        }

        console.log("Selector encontrado:", $select.length > 0 ? "S√≠" : "No");
        if ($select.length > 0) {
          console.log("Valor del selector:", $select.val());
        }
      });

      // Verificar todos los selectores de talle
      $('#todoslosmodelos select.talle').each(function() {
        console.log("Selector de talle encontrado:", $(this).attr('id'));
      });

      // Verificar todos los botones de agregar al carrito
      $('.add-to-cart-btn').each(function() {
        console.log("Bot√≥n de agregar al carrito:", $(this).data('model'));
      });

      // Agregar un manejador de eventos directo para los botones de agregar al carrito
      $(document).on('click', '.add-to-cart-btn', function() {
        var modelId = $(this).data('model');
        console.log("Bot√≥n clickeado directamente:", modelId);

        // Obtener el selector de talle correspondiente
        var $select = $('#talle-select-' + modelId);
        console.log("Selector encontrado:", $select.length > 0 ? "S√≠" : "No");

        if ($select.length > 0) {
          var selectedValue = $select.val();
          console.log("Valor seleccionado:", selectedValue);

          if (selectedValue) {
            // Actualizar manualmente el campo de productos
            var currentValue = $('#286442883').val() || "";
            var productsArray = currentValue.split(', ').filter(Boolean);

            // Agregar el nuevo valor si no existe
            if (!productsArray.includes(selectedValue)) {
              productsArray.push(selectedValue);
              var newValue = productsArray.join(', ');
              $('#286442883').val(newValue);
              console.log("Campo de productos actualizado manualmente:", newValue);
            }
          }
        }
      });
    });
      $('body').append(`
        <div id="instructions-popover" style="display: none;">
          <!-- Capa transparente que cubre toda la pantalla -->
          <div id="overlay"></div>

          <!-- Contenido del pop-over -->
          <div>
            <h2 style="font-size: 1.1em;font-weight: bold;margin-bottom: 20px;">INSTRUCCIONES IMPORTANTES</h2>
            <p style="text-align: left;">1) Apenas realices tu pedido te contactaremos por Whatsapp para confirmar el d√≠a y hora de entrega. Debes confirmar para que lo enviemos.</p>
            <p style="text-align: left;">2) Procura ya tener el efectivo disponible al momento de llegar el delivery para pagar r√°pidamente en la puerta de tu domicilio. Por cuestiones de seguridad no puedes hacer esperar a qui√©n te entrega.</p>
            <p style="text-align: left;">3) No se puede abrir el paquete ni hacer pruebas de talle en la puerta. El delivery llega, entrega, cobra y se va ya que es un servicio externo a nosotros. Si luego necesitas cambiar por talle ponte en contacto con nosotros que te enviamos el cambio sin costo.</p>
          </div>
        </div>
      `);

      // Agregar estilos para el pop-over
      $('<style>').text(`
        #instructions-popover {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          z-index: 9999;
        }
        #overlay {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.7);
        }
        #instructions-popover > div:nth-child(2) {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background-color: white;
          padding: 20px;
          border-radius: 5px;
          max-width: 90%;
          width: 500px;
        }
        .instructions-link {
          color: #0066cc;
          text-decoration: underline;
        }
      `).appendTo('head');

      // Mostrar pop-over al hacer clic en el enlace
      $(document).on("click", ".instructions-link", function(event) {
        event.preventDefault();
        $("#instructions-popover").show();
      });

      // Ocultar pop-over al hacer clic en la capa transparente
      $("#overlay").on("click", function() {
        $("#instructions-popover").hide();
      });

    </script>

    <!-- WhatsApp Modal -->
    <div id="whatsapp-modal" class="whatsapp-modal">
        <div class="whatsapp-modal-overlay"></div>
        <div class="whatsapp-modal-content">
            <div class="whatsapp-modal-header">
                <h3>Ingresa tu WhatsApp para continuar</h3>
            </div>
            <div class="whatsapp-modal-body">
                <p class="whatsapp-modal-message">Para poder continuar con tu pedido y guardar tu carrito, necesitamos tu n√∫mero de WhatsApp.</p>
                <div class="whatsapp-form-group">
                    <input type="tel" id="whatsapp-modal-input" class="form-control" placeholder="Ej: 1156457057 (sin 0 ni 15)" />
                    <div class="whatsapp-error-message"></div>
                </div>
                <button id="whatsapp-modal-submit" class="whatsapp-modal-button">Guardar y Continuar</button>
                <p class="whatsapp-modal-note">Tu n√∫mero se usar√° para el seguimiento de tu pedido y guardar tu carrito.</p>
            </div>
        </div>
    </div>

    <!-- WhatsApp Modal Script -->
    <script>
    (function() {
        console.log('[WhatsApp Modal] Inicializando...');
        const whatsappModal = document.getElementById('whatsapp-modal');
        const whatsappModalInput = document.getElementById('whatsapp-modal-input');
        const whatsappModalSubmit = document.getElementById('whatsapp-modal-submit');
        const whatsappErrorMessage = document.querySelector('.whatsapp-error-message');
        const mainWhatsappInput = document.getElementById('501094818'); // ID espec√≠fico para contrareembolso

        // Endpoints
        const validateWhatsappEndpoint = "https://sswebhookss.odontolab.co/webhook/02eb0643-1b9d-4866-87a7-f892d6a945ea";
        const saveWhatsappEndpoint = "https://sswebhookss.odontolab.co/webhook/1d018fb5-b798-4218-9c57-b48e3a71c6a7";

        let isValidating = false;
        let isValid = false;

        function formatWhatsappNumber(number) {
            console.log('üîç [WhatsApp Modal] formatWhatsappNumber llamado con:', number);
            console.log('üîç [WhatsApp Modal] =============================================');
            
            if (!number) {
                console.log('‚ùå [WhatsApp Modal] N√∫mero vac√≠o, retornando string vac√≠o');
                return '';
            }
            
            let formatted = number.replace(/[\s\-()]/g, '');
            console.log('üîß [WhatsApp Modal] Despu√©s de limpiar caracteres especiales:', formatted);
            
            // ‚úÖ CORRECCI√ìN DEFINITIVA: Verificar 549 PRIMERO para evitar el "9" extra
            console.log('üîç [WhatsApp Modal] PASO 1: Verificando si empieza con "549"...');
            if (formatted.startsWith('549')) {
                console.log('‚úÖ [WhatsApp Modal] ‚úÖ CORRECTO: Ya empieza con 549, retornando intacto:', formatted);
                return formatted;
            }
            console.log('‚ùå [WhatsApp Modal] ‚ùå NO empieza con 549');
            
            // ‚úÖ CORRECCI√ìN: Ahora verificar si empieza con "54" y removerlo
            console.log('üîç [WhatsApp Modal] PASO 2: Verificando si empieza con "54" o "+54"...');
            if (formatted.startsWith('+54')) {
                console.log('üîß [WhatsApp Modal] Quitando "+54"');
                formatted = formatted.substring(3);
            } else if (formatted.startsWith('54')) {
                console.log('üîß [WhatsApp Modal] Quitando "54"');
                formatted = formatted.substring(2);
            } else {
                console.log('‚ùå [WhatsApp Modal] NO empieza con 54');
            }
            
            // ‚úÖ Continuar con otros procesamientos
            console.log('üîß [WhatsApp Modal] PASO 3: Removiendo "0" inicial si existe...');
            if (formatted.startsWith('0')) {
                console.log('üîß [WhatsApp Modal] Quitando "0" inicial');
                formatted = formatted.substring(1);
            }
            
            console.log('üîß [WhatsApp Modal] PASO 4: Procesando c√≥digo de √°rea 15...');
            if (formatted.length > 2 && formatted.substring(2, 4) === '15') {
                console.log('üîß [WhatsApp Modal] Quitando c√≥digo "15" de la posici√≥n 2');
                formatted = formatted.substring(0, 2) + formatted.substring(4);
            }
            
            console.log('üîß [WhatsApp Modal] Despu√©s de procesar todos los prefijos:', formatted);
            
            if (!/^\d+$/.test(formatted)) {
                console.log('‚ùå [WhatsApp Modal] Formato inv√°lido despu√©s de regex, retornando string vac√≠o');
                return '';
            }
            
            const finalResult = '549' + formatted;
            console.log('‚ö†Ô∏è [WhatsApp Modal] PASO FINAL: Agregando prefijo 549. Resultado final:', finalResult);
            console.log('üîç [WhatsApp Modal] =============================================');
            return finalResult;
        }

        function showMessage(message, type = 'error') {
            if (!whatsappErrorMessage) return;
            whatsappErrorMessage.textContent = message;
            whatsappErrorMessage.className = 'whatsapp-error-message'; // Reset classes
            
            // Handle different message types
            if (type === 'valid') {
                whatsappErrorMessage.classList.add('valid');
            } else if (type === 'verifying') {
                whatsappErrorMessage.classList.add('verifying');
            } else if (type === 'error' || isError === true) {
                // Error is default, no additional class needed
            }
        }

        function validateInput(inputValue) {
            if (!inputValue) return false;
            const formattedNumber = formatWhatsappNumber(inputValue);
            // Validar que el n√∫mero tenga el formato correcto y la longitud adecuada
            return formattedNumber && formattedNumber.length >= 12;
        }

        function saveWhatsappToEndpoint(whatsappNumber) {
            console.log('[WhatsApp Modal] Guardando WhatsApp en endpoint:', whatsappNumber);
            const xhr = new XMLHttpRequest();
            xhr.open('POST', saveWhatsappEndpoint, true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            const data = {
                whatsapp: whatsappNumber,
                timestamp: new Date().toISOString(),
                source: 'modal_whatsapp_contrareembolso',
                url: window.location.href
            };

            console.log('[WhatsApp Modal] Enviando datos al endpoint:', data);
            xhr.send(JSON.stringify(data));
        }

        function saveWhatsappAndClose() {
            console.log('[WhatsApp Modal] Intentando guardar y cerrar...');
            const inputValue = whatsappModalInput.value.trim();
            if (!validateInput(inputValue)) {
                console.log('[WhatsApp Modal] Formato inv√°lido, no se guardar√°');
                return;
            }

            const whatsappNumber = formatWhatsappNumber(inputValue);
            console.log('[WhatsApp Modal] N√∫mero formateado:', whatsappNumber);

            // Guardar en localStorage
            localStorage.setItem('savedWhatsapp', whatsappNumber);
            localStorage.setItem('whatsappModalShown', 'true');

            // Actualizar campo principal
            if (mainWhatsappInput) {
                mainWhatsappInput.value = whatsappNumber;
                mainWhatsappInput.dispatchEvent(new Event('input', { bubbles: true }));
                mainWhatsappInput.dispatchEvent(new Event('blur', { bubbles: true }));
            }

            // Guardar en el endpoint
            saveWhatsappToEndpoint(whatsappNumber);

            // Cerrar el modal
            whatsappModal.classList.remove('active');
        }

        // Event Listeners
        whatsappModalInput.addEventListener('input', function() {
            const inputValue = this.value.trim();
            const isValidFormat = validateInput(inputValue);
            whatsappModalSubmit.disabled = !isValidFormat;
            if (isValidFormat) {
                showMessage('Formato v√°lido', false);
            } else if (inputValue) {
                showMessage('Formato de WhatsApp inv√°lido. Ej: 1156457057');
            } else {
                showMessage('');
            }
        });

        whatsappModalSubmit.addEventListener('click', saveWhatsappAndClose);

        window.showWhatsappModal = function() {
            console.log('[WhatsApp Modal] Mostrando modal...');
            whatsappModal.classList.add('active');
            whatsappModalInput.value = '';
            showMessage('');

            const savedWhatsapp = localStorage.getItem('savedWhatsapp');
            if (savedWhatsapp) {
                whatsappModalInput.value = savedWhatsapp;
                const isValidFormat = validateInput(savedWhatsapp);
                whatsappModalSubmit.disabled = !isValidFormat;
                if (isValidFormat) {
                    showMessage('Formato v√°lido', false);
                }
            }
        };

        // Event listener para agregar al carrito
        document.addEventListener('click', function(event) {
            if (
                (event.target.classList.contains('add-to-cart-btn') ||
                (event.target.parentElement && event.target.parentElement.classList.contains('add-to-cart-btn'))) &&
                !localStorage.getItem('whatsappModalShown')
            ) {
                console.log('[WhatsApp Modal] Bot√≥n de agregar al carrito clickeado');
                setTimeout(function() {
                    const cartCount = document.querySelector('.cart-count');
                    console.log('[WhatsApp Modal] Cart count:', cartCount ? cartCount.textContent : 'no cartCount');
                    if (cartCount && parseInt(cartCount.textContent) > 0) {
                        window.showWhatsappModal();
                    }
                }, 500);
            }
        }, true);

        console.log('[WhatsApp Modal] Inicializaci√≥n completada');
    })();
    </script>

    <!-- Validaci√≥n onBlur para Campo WhatsApp Principal -->
    <script>
    (function() {
        console.log('üîç [WhatsApp onBlur] Inicializando validaci√≥n inline...');
        
        // Endpoint para validaci√≥n de WhatsApp
        const validateWhatsappEndpoint = "https://sswebhookss.odontolab.co/webhook/02eb0643-1b9d-4866-87a7-f892d6a945ea";
        
        let isValidating = false;

        function formatWhatsappNumber(number) {
            console.log('üîç [WhatsApp onBlur] formatWhatsappNumber llamado con:', number);
            console.log('üîç [WhatsApp onBlur] =============================================');
            
            if (!number) {
                console.log('‚ùå [WhatsApp onBlur] N√∫mero vac√≠o, retornando string vac√≠o');
                return '';
            }
            
            let formatted = number.replace(/[\s\-()]/g, '');
            console.log('üîß [WhatsApp onBlur] Despu√©s de limpiar caracteres especiales:', formatted);
            
            // ‚úÖ CORRECCI√ìN DEFINITIVA: Verificar 549 PRIMERO para evitar el "9" extra
            console.log('üîç [WhatsApp onBlur] PASO 1: Verificando si empieza con "549"...');
            if (formatted.startsWith('549')) {
                console.log('‚úÖ [WhatsApp onBlur] ‚úÖ CORRECTO: Ya empieza con 549, retornando intacto:', formatted);
                return formatted;
            }
            console.log('‚ùå [WhatsApp onBlur] ‚ùå NO empieza con 549');
            
            // ‚úÖ CORRECCI√ìN: Ahora verificar si empieza con "54" y removerlo
            console.log('üîç [WhatsApp onBlur] PASO 2: Verificando si empieza con "54" o "+54"...');
            if (formatted.startsWith('+54')) {
                console.log('üîß [WhatsApp onBlur] Quitando "+54"');
                formatted = formatted.substring(3);
            } else if (formatted.startsWith('54')) {
                console.log('üîß [WhatsApp onBlur] Quitando "54"');
                formatted = formatted.substring(2);
            } else {
                console.log('‚ùå [WhatsApp onBlur] NO empieza con 54');
            }
            
            // ‚úÖ Continuar con otros procesamientos
            console.log('üîß [WhatsApp onBlur] PASO 3: Removiendo "0" inicial si existe...');
            if (formatted.startsWith('0')) {
                console.log('üîß [WhatsApp onBlur] Quitando "0" inicial');
                formatted = formatted.substring(1);
            }
            
            console.log('üîß [WhatsApp onBlur] PASO 4: Procesando c√≥digo de √°rea 15...');
            if (formatted.length > 2 && formatted.substring(2, 4) === '15') {
                console.log('üîß [WhatsApp onBlur] Quitando c√≥digo "15" de la posici√≥n 2');
                formatted = formatted.substring(0, 2) + formatted.substring(4);
            }
            
            console.log('üîß [WhatsApp onBlur] Despu√©s de procesar todos los prefijos:', formatted);
            
            if (!/^\d+$/.test(formatted)) {
                console.log('‚ùå [WhatsApp onBlur] Formato inv√°lido despu√©s de regex, retornando string vac√≠o');
                return '';
            }
            
            const finalResult = '549' + formatted;
            console.log('‚ö†Ô∏è [WhatsApp onBlur] PASO FINAL: Agregando prefijo 549. Resultado final:', finalResult);
            console.log('üîç [WhatsApp onBlur] =============================================');
            return finalResult;
        }

        function showWhatsAppError(fieldId, message, isValid = false) {
            console.log(`üîç [WhatsApp onBlur] Mostrando error: "${message}" para campo ${fieldId}, v√°lido: ${isValid}`);
            
            const field = document.getElementById(fieldId);
            const errorElement = document.querySelector(`.error-message[data-target="${fieldId}"]`);
            
            if (field) {
                if (isValid) {
                    field.style.borderColor = '#27ae60'; // Verde para v√°lido
                    field.style.backgroundColor = '#f8fff8';
                } else {
                    field.style.borderColor = '#e74c3c'; // Rojo para inv√°lido
                    field.style.backgroundColor = '#fff8f8';
                }
            }
            
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.color = isValid ? '#27ae60' : '#e74c3c';
                errorElement.className = isValid ? 'error-message valid' : 'error-message';
            }
        }

        function validateInputFormat(inputValue) {
            if (!inputValue) return false;
            const formattedNumber = formatWhatsappNumber(inputValue);
            return formattedNumber && formattedNumber.length >= 12;
        }

        // Funci√≥n global para validar WhatsApp al desenfocar el campo
        window.validateWhatsAppInline = async function() {
            console.log('üîç [WhatsApp onBlur] Funci√≥n validateWhatsAppInline ejecutada');
            
            const whatsappInput = document.getElementById('501094818');
            if (!whatsappInput) {
                console.error('‚ùå [WhatsApp onBlur] Campo WhatsApp no encontrado');
                return;
            }

            const inputValue = whatsappInput.value.trim();
            console.log('üîç [WhatsApp onBlur] Valor del campo:', inputValue);

            if (!inputValue) {
                console.log('‚ö†Ô∏è [WhatsApp onBlur] Campo vac√≠o, limpiando estado');
                showWhatsAppError('501094818', '');
                return;
            }

            if (!validateInputFormat(inputValue)) {
                console.log('‚ùå [WhatsApp onBlur] Formato inv√°lido');
                showWhatsAppError('501094818', 'Formato de WhatsApp inv√°lido. Ej: 1156457057');
                return;
            }

            if (isValidating) {
                console.log('‚è≥ [WhatsApp onBlur] Ya hay una validaci√≥n en proceso');
                return;
            }

            console.log('üîÑ [WhatsApp onBlur] Iniciando validaci√≥n con webhook...');
            isValidating = true;
            showWhatsAppError('501094818', 'Verificando WhatsApp...', true);

            const whatsappNumber = formatWhatsappNumber(inputValue);
            console.log('üîç [WhatsApp onBlur] N√∫mero formateado:', whatsappNumber);

            try {
                console.log('üåê [WhatsApp onBlur] Enviando solicitud al webhook:', validateWhatsappEndpoint);
                
                const response = await fetch(validateWhatsappEndpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ whatsapp_check: whatsappNumber })
                });

                console.log('üì° [WhatsApp onBlur] Respuesta recibida:', response.status);

                if (!response.ok) {
                    throw new Error(`API response not OK: ${response.status}`);
                }

                const data = await response.json();
                console.log('üìã [WhatsApp onBlur] Datos de respuesta:', data);

                if (data.exists === true) {
                    console.log('‚úÖ [WhatsApp onBlur] WhatsApp v√°lido');
                    showWhatsAppError('501094818', '¬°WhatsApp v√°lido!', true);
                } else {
                    console.log('‚ùå [WhatsApp onBlur] WhatsApp inv√°lido seg√∫n webhook');
                    showWhatsAppError('501094818', 'WhatsApp inv√°lido, por favor corr√≠jalo.');
                }

            } catch (error) {
                console.error('‚ùå [WhatsApp onBlur] Error en la validaci√≥n:', error);
                showWhatsAppError('501094818', 'Error de red. Intenta de nuevo.');
            } finally {
                isValidating = false;
                console.log('üèÅ [WhatsApp onBlur] Validaci√≥n finalizada');
            }
        };

        console.log('‚úÖ [WhatsApp onBlur] Validaci√≥n inline inicializada correctamente');
    })();
    </script>

    <!-- Facebook Pixel Dual Tracking Functions -->
    <script>
    (function() {
        // Funci√≥n para generar Event ID √∫nico
        window.generateEventId = function() {
            return 'fb_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        };

        // Funci√≥n auxiliar para obtener cookies
        window.getCookie = function(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return '';
        };

        // Funci√≥n para establecer cookies
        window.setCookie = function(name, value, days) {
            const expires = new Date();
            expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/;SameSite=Lax`;
        };

        // Funci√≥n para obtener par√°metro de URL
        window.getUrlParameter = function(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        };

        // Funci√≥n para generar y gestionar FBC (Facebook Click ID)
        window.generateFBC = function() {
            let fbc = getCookie('_fbc');

            // Si no existe FBC, intentar crearlo desde fbclid
            if (!fbc) {
                const fbclid = getUrlParameter('fbclid');
                if (fbclid) {
                    // Verificar si ya tenemos un timestamp guardado para este fbclid
                    const savedTimestamp = localStorage.getItem('initial_fbclid_timestamp');
                    const savedFbclid = localStorage.getItem('initial_fbclid');

                    let timestamp;
                    if (savedFbclid === fbclid && savedTimestamp) {
                        // Usar el timestamp original si es el mismo fbclid
                        timestamp = savedTimestamp;
                        console.log('‚úÖ Reutilizando timestamp original:', timestamp);
                    } else {
                        // Nuevo fbclid, crear nuevo timestamp
                        timestamp = Math.floor(Date.now() / 1000);
                        localStorage.setItem('initial_fbclid_timestamp', timestamp);
                        console.log('‚úÖ Nuevo timestamp creado:', timestamp);
                    }

                    // Guardar fbclid inicial para uso posterior en p√°ginas de gracias
                    localStorage.setItem('initial_fbclid', fbclid);

                    // Formato: fb.1.timestamp.fbclid (usando timestamp original)
                    fbc = `fb.1.${timestamp}.${fbclid}`;
                    setCookie('_fbc', fbc, 90); // Guardar por 90 d√≠as
                    console.log('‚úÖ FBC generado desde fbclid:', fbc);
                    console.log('‚úÖ fbclid inicial guardado en localStorage:', fbclid);
                }
            }

            return fbc || '';
        };

        // Funci√≥n para generar y gestionar FBP (Facebook Browser ID)
        window.generateFBP = function() {
            let fbp = getCookie('_fbp');

            // Si no existe FBP, generarlo
            if (!fbp) {
                // Formato: fb.1.timestamp.random
                const timestamp = Math.floor(Date.now() / 1000);
                const random = Math.random().toString(36).substr(2, 9);
                fbp = `fb.1.${timestamp}.${random}`;
                setCookie('_fbp', fbp, 90); // Guardar por 90 d√≠as
                console.log('‚úÖ FBP generado:', fbp);
            }

            return fbp;
        };

        // Funci√≥n para inicializar tracking de Facebook
        window.initializeFacebookTracking = function() {
            // Generar/obtener FBC y FBP
            const fbc = generateFBC();
            const fbp = generateFBP();

            // Guardar en localStorage como respaldo
            if (fbc) localStorage.setItem('facebook_fbc', fbc);
            if (fbp) localStorage.setItem('facebook_fbp', fbp);

            console.log('üîµ Facebook Tracking inicializado (Contrareembolso):', { fbc, fbp });

            return { fbc, fbp };
        };

        // Funci√≥n mejorada para obtener FBC/FBP
        window.getFacebookParams = function() {
            return {
                fbc: getCookie('_fbc') || localStorage.getItem('facebook_fbc') || '',
                fbp: getCookie('_fbp') || localStorage.getItem('facebook_fbp') || ''
            };
        };

        // Funci√≥n de env√≠o dual (cliente + servidor) - FORMATO N8N
        window.sendDualEvent = async function(eventName, eventData) {
            const eventId = generateEventId();

            // 1. Enviar a Facebook (Cliente)
            if (typeof fbq !== 'undefined') {
                fbq('track', eventName, {
                    ...eventData,
                    event_id: eventId
                });
            }

            // 2. Obtener par√°metros de Facebook (FBC/FBP)
            const fbParams = getFacebookParams();

            // 3. Preparar payload para Facebook Events API (formato N8N)
            const facebookEventData = {
                event_name: eventName,
                event_id: eventId,
                event_time: Math.floor(Date.now() / 1000),
                action_source: 'website',
                event_source_url: window.location.href,
                user_data: {
                    client_ip_address: '', // N8N puede obtener esto del request
                    client_user_agent: navigator.userAgent,
                    fbc: fbParams.fbc,
                    fbp: fbParams.fbp
                },
                custom_data: eventData
            };

            // 4. Enviar al webhook en formato para N8N Facebook Events
            try {
                await fetch('https://sswebhookss.odontolab.co/webhook/9dfb840b-2a21-4277-8aec-1666bfaaac89', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        data: [facebookEventData] // Array con el evento, listo para Facebook Events API
                    })
                });
                console.log('‚úÖ Evento enviado al servidor:', eventName, 'FBC:', fbParams.fbc, 'FBP:', fbParams.fbp);
            } catch (error) {
                console.error('‚ùå Error enviando evento al servidor:', error);
            }
        };

        // Funci√≥n para calcular precios seg√∫n p√°gina y cantidad
        window.calculatePrice = function(quantity) {
            const isContrareembolso = window.location.href.includes('contrareembolso');

            if (isContrareembolso) {
                // Contrareembolso: 1 par = $55.000 | 2+ pares = $42.500 c/u
                return quantity === 1 ? 55000 : 42500;
            } else {
                // Previo pago: 1 par = $70.000 | 2+ pares = $55.000 c/u
                return quantity === 1 ? 70000 : 55000;
            }
        };

        // Funci√≥n para calcular total del carrito
        window.calculateCartTotal = function(cartItems) {
            const isContrareembolso = window.location.href.includes('contrareembolso');
            const totalItems = cartItems.length;

            if (isContrareembolso) {
                return totalItems === 1 ? 55000 : totalItems * 42500;
            } else {
                return totalItems === 1 ? 70000 : totalItems * 55000;
            }
        };

        // Inicializar tracking de Facebook cuando se carga la p√°gina
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeFacebookTracking);
        } else {
            initializeFacebookTracking();
        }
    })();
    </script>



    <!-- Testimonials Dynamic Loading Script -->
    <script>
    (function() {
        // Lista completa de comentarios disponibles
        const allTestimonials = [
            { src: 'comentarios/comentariorecibi1.webp', alt: 'Captura de comentario positivo de clienta 1' },
            { src: 'comentarios/comentariorecibi2.webp', alt: 'Captura de comentario positivo de clienta 2' },
            { src: 'comentarios/comentariorecibi4.webp', alt: 'Captura de comentario positivo de clienta 3' },
            { src: 'comentarios/comentariorecibi5.webp', alt: 'Captura de comentario positivo de clienta 4' },
            { src: 'comentarios/comentariorecibi6.webp', alt: 'Captura de comentario positivo de clienta 5' },
            { src: 'comentarios/comentariorecibi7.webp', alt: 'Captura de comentario positivo de clienta 6' },
            { src: 'comentarios/comentariorecibi8.webp', alt: 'Captura de comentario positivo de clienta 7' },
            { src: 'comentarios/comentariosig.webp', alt: 'Captura de comentarios de Instagram' },
            { src: 'comentarios/comentario1-min.webp', alt: 'Testimonio destacado 1' },
            { src: 'comentarios/comentario2-min.webp', alt: 'Testimonio destacado 2' },
            { src: 'comentarios/comentario3-min.webp', alt: 'Referencia de clienta satisfecha 1' },
            { src: 'comentarios/comentario4-min.webp', alt: 'Referencia de clienta satisfecha 2' },
            { src: 'comentarios/comentario5-min.webp', alt: 'Referencia de clienta satisfecha 3' },
            { src: 'comentarios/comentariosig2.webp', alt: 'Comentarios adicionales de Instagram' },
            { src: 'comentarios/1000781400.webp', alt: 'Testimonio de clienta satisfecha' },
            { src: 'comentarios/1000782704.webp', alt: 'Comentario positivo de compra' },
            { src: 'comentarios/1000783152.webp', alt: 'Experiencia positiva de clienta' },
            { src: 'comentarios/1000783153.webp', alt: 'Rese√±a favorable de producto' },
            { src: 'comentarios/1000783154.webp', alt: 'Comentario de satisfacci√≥n' },
            { src: 'comentarios/1000783155.webp', alt: 'Testimonio de calidad' },
            { src: 'comentarios/1000783157.webp', alt: 'Experiencia de compra positiva' },
            { src: 'comentarios/1000783785-b.webp', alt: 'Comentario de recomendaci√≥n adicional' },
            { src: 'comentarios/1000783785.webp', alt: 'Comentario de recomendaci√≥n' },
            { src: 'comentarios/1000783786.webp', alt: 'Testimonio de entrega' },
            { src: 'comentarios/1000786213.webp', alt: 'Rese√±a de producto' },
            { src: 'comentarios/1000786214.webp', alt: 'Comentario de calidad' },
            { src: 'comentarios/1000786216-b.webp', alt: 'Experiencia satisfactoria adicional' },
            { src: 'comentarios/1000786216.webp', alt: 'Experiencia satisfactoria' },
            { src: 'comentarios/1000792702.webp', alt: 'Testimonio reciente' },
            { src: 'comentarios/1000792703.webp', alt: 'Comentario de clienta feliz' },
            { src: 'comentarios/comentariowsp1.webp', alt: 'Comentario de WhatsApp de clienta satisfecha' },
            { src: 'comentarios/comentariowsp2.webp', alt: 'Testimonio por WhatsApp de clienta feliz' },
            { src: 'comentarios/igcomentario1.webp', alt: 'Comentario de Instagram de clienta' }
        ].sort(() => Math.random() - 0.5); // Mezclar aleatoriamente

        let currentIndex = 0;
        const itemsPerLoad = 6;
        let isLoading = false;
        let allLoaded = false;

        const testimonialsGrid = document.getElementById('testimonials-grid');
        const loadingIndicator = document.getElementById('testimonials-loading');
        const backToProductsBtn = document.getElementById('back-to-products');
        const loadMoreLink = document.getElementById('load-more-testimonials');

        function createTestimonialElement(testimonial, index) {
            const div = document.createElement('div');
            div.className = 'testimonial-item';
            div.style.animationDelay = `${(index % itemsPerLoad) * 0.1}s`;

            const img = document.createElement('img');
            img.src = testimonial.src;
            img.alt = testimonial.alt;
            img.loading = 'lazy';

            img.onload = function() {
                div.style.opacity = '1';
                div.style.transform = 'translateY(0)';
                testimonialsGrid.style.height = 'auto';
            };

            img.onerror = function() {
                div.style.display = 'none';
            };

            div.appendChild(img);
            return div;
        }

        function loadTestimonials() {
            if (isLoading || allLoaded) {
                return;
            }

            isLoading = true;
            loadingIndicator.style.display = 'block';
            if(loadMoreLink) loadMoreLink.style.display = 'none';

            setTimeout(() => {
                const endIndex = Math.min(currentIndex + itemsPerLoad, allTestimonials.length);

                for (let i = currentIndex; i < endIndex; i++) {
                    const testimonialElement = createTestimonialElement(allTestimonials[i], i);
                    testimonialsGrid.appendChild(testimonialElement);
                }

                currentIndex = endIndex;

                if (currentIndex >= allTestimonials.length) {
                    allLoaded = true;
                    if(loadMoreLink) loadMoreLink.style.display = 'none';
                } else {
                    if(loadMoreLink) loadMoreLink.style.display = 'block';
                }

                loadingIndicator.style.display = 'none';
                isLoading = false;

                updateBackToProductsButton();

            }, 600);
        }

        function updateBackToProductsButton() {
            const cartItems = document.querySelectorAll('.cart-item');
            const hasItems = cartItems.length > 0;

            if (!hasItems && currentIndex >= itemsPerLoad) {
                backToProductsBtn.style.display = 'block';
            } else {
                backToProductsBtn.style.display = 'none';
            }
        }

        window.scrollToProducts = function() {
            const productSection = document.getElementById('todoslosmodelos');
            if (productSection) {
                productSection.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            loadTestimonials();

            if(loadMoreLink) {
                loadMoreLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    loadTestimonials();
                });
            }

            const cartObserver = new MutationObserver(updateBackToProductsButton);
            const cartContainer = document.querySelector('.cart-items');
            if (cartContainer) {
                cartObserver.observe(cartContainer, {
                    childList: true,
                    subtree: true
                });
            }
        });

    })();
    </script>

</body>
</html>
